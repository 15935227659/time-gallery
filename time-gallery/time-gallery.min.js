'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 *  @Width: 画布宽
 *  @Height: 画布高
 *  @isState: 是否启动 Stage.js 测试FPS, 依赖 stage.js
 *  @isLog: 是否打印数据结构
 *  @direction: 可设置水平(horizontal)或垂直(vertical)
 *  @resourcesPath: 图片资源加载的默认路劲
 *  @resources: 图片资源
 *  @sprites: 自定义雪碧图数据数组，方便创建数据的时候可随时调用雪碧图
 *  @data: 创建画布数据
 *  @onInit: 初始化后的回调
 *  @onEnd: 结束后的回调
 *  @onTickStart: 每一帧的开始前回调
 *  @onTickEnd: 每一帧的结束后回调
 *  @mapStart: 定义画布始点位置
 *  @mapActive: 定义画布当前的播放的位置（可方便测试）
 *  @mapEnd: 画布默认结束位置，默认是 animatePlayEnd 最大值或地图的高度
 *  @mapPlay: 定义画布播放动画的位置（默认元素再屏幕底部的位置开始播放动画）
 *  @touchSpeed: 定义用户滑动速度，越大，滑动的速度越快
 *  @autoPlay: 是否自动播放
 *  @autoSpeed: 自动播放速度
 */

var TimeGallery = function () {
    function TimeGallery(options) {
        _classCallCheck(this, TimeGallery);

        if (options.id === '') {
            console.error('ID not exist');
        }

        this.width = options.width || window.innerWidth;
        this.height = options.height || window.innerHeight;
        this._stage = new createjs.Stage(document.getElementById(options.id));
        this._stage.canvas.width = this.width;
        this._stage.canvas.height = this.height;
        this._loadQueue = null;
        this._isLoading = false;
        this._isEnd = false;
        this._dirGroup = {
            horizontal: 'horizontal',
            vertical: 'vertical'
        };

        this.isVertical = (options.direction || this._dirGroup.vertical) === this._dirGroup.vertical;
        this.isMoving = false;
        this.isState = options.isState || false;
        this.isLog = options.isLog || false;

        this.autoPlay = options.autoPlay || false;
        this.autoSpeed = options.autoSpeed || 1;

        this.resourcesPath = options.resourcesPath || '';
        this.resources = options.resources || [];
        this.sprites = options.sprites || {};
        this.data = options.data || [];

        this.onInit = options.onInit || null;
        this.onEnd = options.onEnd || null;
        this.onTickStart = options.onTickStart || null;
        this.onTickEnd = options.onTickEnd || null;

        this.mapStart = options.mapStart || 0;
        this.mapActive = options.mapActive || 0;
        this.mapEnd = options.mapEnd || 0;
        this.mapPlay = options.mapPlay || (this.isVertical ? this.height : this.width);

        this.objects = {};
        this.animatorsGroup = []; // 执行动画的数组
        this.touchData = {
            touchstart: 0, // TouchStart 初始 Y 位置
            touchmove: 0, // TouchMove  初始 Y 距离
            friction: 0.9, // 摩擦值
            speed: options.touchSpeed || 1, // Touch 滑动速度
            isInertance: false // 惯性
        };

        this.init();
    }

    _createClass(TimeGallery, [{
        key: 'init',
        value: function init() {
            var _this = this;

            this._preload(this.resources, {
                path: this.resourcesPath,
                onComplete: function onComplete() {

                    if (typeof _this.sprites === 'function') _this.sprites = _this.sprites(_this);
                    if (typeof _this.data === 'function') _this.data = _this.data(_this);

                    var data = [{
                        id: 'map',
                        children: _this.data
                    }];

                    // 渲染图像数据
                    _this._render(data, null, function (displayObject, obj) {
                        if (displayObject) {
                            if (obj.animation) {
                                displayObject.animation = _this._createAnimate(displayObject, obj.animation);
                                _this.animatorsGroup.push({ displayObject: displayObject });
                            }
                        }
                    });

                    _this.map = _this.objects['map'];

                    var mapActive = _this.mapActive ? -_this.mapActive : -_this.mapStart;

                    if (_this.isVertical) {
                        _this.map.y = mapActive;
                    } else {
                        _this.map.x = mapActive;
                    }

                    if (!_this.mapEnd) {
                        var mapLong = void 0;
                        if (_this.isVertical) {
                            mapLong = _this.map.getBounds().height + _this.map.getBounds().y - _this.height;
                        } else {
                            mapLong = _this.map.getBounds().width + _this.map.getBounds().x - _this.width;
                        }
                        var maxAnimatePlayEnd = Math.max.apply(Math, _this.animatorsGroup.map(function (item) {
                            return item.displayObject.animation.animatePlayEnd;
                        }));
                        _this.mapEnd = Math.max(mapLong, maxAnimatePlayEnd);
                    }

                    // 初始化滑动事件
                    _this._initTouchEvent();

                    if (_this.onInit) _this.onInit();

                    // 是否打印 FPS 状态，依赖 state.js
                    if (_this.isState) _this._stats();

                    _this._stage.update();
                }
            });

            createjs.Ticker.timingMode = createjs.Ticker.RAF;
        }
    }, {
        key: 'play',
        value: function play() {
            createjs.Ticker.addEventListener('tick', this._onTick.bind(this));
        }
    }, {
        key: 'replay',
        value: function replay() {
            this._isEnd = false;

            this.touchData.touchstart = 0;
            this.touchData.touchmove = 0;
            this.touchData.isInertance = false;

            if (this.isVertical) {
                this.map.y = -this.mapStart;
            } else {
                this.map.x = -this.mapStart;
            }

            this.animatorsGroup.forEach(function (item) {
                item.displayObject.animation.set(0);
            });

            this._stage.update();

            this.play();
        }
    }, {
        key: 'stop',
        value: function stop() {
            createjs.Ticker.removeAllEventListeners();
        }
    }, {
        key: 'getImage',
        value: function getImage(id) {
            return this._loadQueue[id];
        }
    }, {
        key: '_onTick',
        value: function _onTick() {
            if (!this._isLoading && this.map) {

                if (this.autoPlay || this.isMoving) {

                    if (this.onTickStart) this.onTickStart(this);

                    var pos = void 0;

                    if (this.autoPlay) {
                        if (this.isVertical) {
                            this.map.y -= this.autoSpeed;
                            pos = -this.map.y;
                        } else {
                            this.map.x -= this.autoSpeed;
                            pos = -this.map.x;
                        }

                        if (this.touchData.touchmove !== 0) {
                            this.touchData.touchstart = 0;
                            this.touchData.touchmove = 0;
                            this.touchData.isInertance = false;
                            this.isMoving = false;
                        }
                    } else if (this.isMoving) {

                        // 如果是惯性
                        if (this.touchData.isInertance) {
                            // 惯性减速
                            this.touchData.touchmove *= this.touchData.friction;

                            if (Math.abs(this.touchData.touchmove) <= 1) {
                                this.touchData.touchstart = 0;
                                this.touchData.touchmove = 0;
                                this.touchData.isInertance = false;
                                this.isMoving = false;
                            }
                        }

                        // 根据滑动的位置记录动画执行
                        if (this.isVertical) {
                            this.map.y += this.touchData.touchmove * this.touchData.speed;
                            pos = -this.map.y;
                        } else {
                            this.map.x += this.touchData.touchmove * this.touchData.speed;
                            pos = -this.map.x;
                        }
                    }

                    if (pos < this.mapStart) {
                        if (this.isVertical) {
                            this.map.y = -this.mapStart;
                        } else {
                            this.map.x = -this.mapStart;
                        }
                    }

                    if (pos > this.mapEnd) {

                        if (this._isEnd) return;

                        this._isEnd = true;

                        if (this.isVertical) {
                            this.map.y = -this.mapEnd;
                        } else {
                            this.map.x = -this.mapEnd;
                        }

                        if (this.onEnd) {
                            this.onEnd();
                            return;
                        }
                    }

                    this.mapActive = this.isVertical ? -this.map.y : -this.map.x;

                    this._updateAnimators();
                }
            }

            if (this.isState) {
                this.stats.update();
            }
        }
    }, {
        key: '_updateAnimators',
        value: function _updateAnimators() {
            var pos = this.isVertical ? -this.map.y : -this.map.x;

            this.animatorsGroup.map(function (obj) {
                var displayObject = obj.displayObject;
                var animatePlayStart = displayObject.animation.animatePlayStart;
                var animatePlayEnd = displayObject.animation.animatePlayEnd;

                if (pos >= animatePlayStart && pos < animatePlayEnd) {
                    var duration = Math.abs(pos - animatePlayStart);
                    displayObject.animation.update(duration);
                } else if (pos < animatePlayStart) {
                    displayObject.animation.update(0);
                } else if (pos > animatePlayEnd) {
                    displayObject.animation.update(animatePlayEnd - animatePlayStart);
                }
            });

            if (this.onTickEnd) this.onTickEnd(this);

            this._stage.update();
        }

        // 初始化手势

    }, {
        key: '_initTouchEvent',
        value: function _initTouchEvent() {
            var _this2 = this;

            this._stage.canvas.addEventListener('touchstart', function (e) {

                if (_this2.autoPlay) return;

                if (_this2.isVertical) {
                    _this2.touchData.touchstart = e.touches[0].clientY;
                } else {
                    _this2.touchData.touchstart = e.touches[0].clientX;
                }

                _this2.touchData.isInertance = false;
                _this2.isMoving = false;
            });

            this._stage.canvas.addEventListener('touchmove', function (e) {
                if (_this2.isVertical) {
                    _this2.touchData.touchmove = e.touches[0].clientY - _this2.touchData.touchstart;
                    _this2.touchData.touchstart = e.touches[0].clientY;
                } else {
                    _this2.touchData.touchmove = e.touches[0].clientX - _this2.touchData.touchstart;
                    _this2.touchData.touchstart = e.touches[0].clientX;
                }
                _this2.isMoving = true;
            });

            this._stage.canvas.addEventListener('touchend', function () {
                if (_this2.autoPlay) return;
                _this2.touchData.isInertance = true;
            });
        }
    }, {
        key: '_preload',
        value: function _preload() {
            var _this3 = this;

            var manifest = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];

            var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
                _ref$onComplete = _ref.onComplete,
                onComplete = _ref$onComplete === undefined ? function () {} : _ref$onComplete,
                _ref$onProgress = _ref.onProgress,
                onProgress = _ref$onProgress === undefined ? function () {} : _ref$onProgress,
                _ref$path = _ref.path,
                path = _ref$path === undefined ? '' : _ref$path;

            this._isLoading = true;

            var fileList = null;

            if (Array.isArray(manifest)) {
                if (manifest.length === 0) return;
                fileList = manifest;
            } else if (typeof manifest === 'string') {
                fileList = [{
                    src: manifest,
                    id: manifest
                }];
            } else if ((typeof manifest === 'undefined' ? 'undefined' : _typeof(manifest)) === 'object') {
                if (!manifest.id) {
                    manifest.id = manifest.src;
                }
                fileList = [manifest];
            } else {
                return false;
            }

            var loadedNumber = 0;
            var preloadNumber = fileList.length;
            var images = {};

            var _loop = function _loop(i) {
                var image = new Image();
                var file = fileList[i];
                var fileType = typeof file === 'undefined' ? 'undefined' : _typeof(file);
                var src = '';

                if (fileType === 'object') {
                    src = file.src;
                } else if (fileType === 'string') {
                    src = file;
                }

                image.src = path + src;
                image.onload = function () {
                    if (file.id) {
                        images[file.id] = image;
                    } else {
                        images[src] = image;
                    }
                    loadedNumber++;

                    var progress = Math.floor(loadedNumber / preloadNumber * 100);
                    onProgress(progress);

                    if (progress >= 100) {
                        _this3._isLoading = false;
                        _this3._loadQueue = images;
                        onComplete();
                    }
                };
            };

            for (var i = 0; i < preloadNumber; i++) {
                _loop(i);
            }

            // 基于 PreloadJs
            // this._loadQueue = new createjs.LoadQueue(true, path);
            //
            // if (progress) this._loadQueue.on('progress', e => onProgress(e));
            //
            // this._loadQueue.on('complete', e => {
            //     this._isLoading = false;
            //     if (onComplete) onComplete(e);
            // });
            //
            // this._loadQueue.loadManifest(loadManifest);
        }
    }, {
        key: '_addObj',
        value: function _addObj() {
            var obj = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};


            var displayObject = null;

            switch (obj.type) {
                case 'shape':
                    displayObject = new createjs.Shape();
                    break;
                case 'bitmap':
                    if (obj.image) {
                        displayObject = new createjs.Bitmap(obj.image);
                    }
                    break;
                case 'text':
                    displayObject = new createjs.Text();
                    break;
                case 'sprite':
                    if (obj.sheet) {
                        var spriteSheet = new createjs.SpriteSheet(obj.sheet);
                        displayObject = new createjs.Sprite(spriteSheet);
                    }
                    break;
                default:
                    displayObject = new createjs.Container();
                    break;
            }

            if (obj.type) {
                displayObject.type = obj.type;
            } else {
                displayObject.type = 'container';
            }

            if (obj.id) displayObject.name = obj.id;

            if (obj.parent_id) displayObject.parentId = obj.parent_id;

            if (obj.prop) {
                var _iteratorNormalCompletion = true;
                var _didIteratorError = false;
                var _iteratorError = undefined;

                try {
                    for (var _iterator = Object.keys(obj.prop)[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                        var propKey = _step.value;

                        // 判断属性类型
                        if (displayObject[propKey] instanceof Object) {
                            var _iteratorNormalCompletion2 = true;
                            var _didIteratorError2 = false;
                            var _iteratorError2 = undefined;

                            try {
                                for (var _iterator2 = Object.keys(obj.prop[propKey])[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
                                    var key = _step2.value;

                                    if (typeof displayObject[propKey][key] === 'function') {
                                        var _displayObject$propKe;

                                        (_displayObject$propKe = displayObject[propKey])[key].apply(_displayObject$propKe, _toConsumableArray(obj.prop[propKey][key]));
                                    } else {
                                        displayObject[propKey][key] = obj.prop[propKey][key];
                                    }
                                }
                            } catch (err) {
                                _didIteratorError2 = true;
                                _iteratorError2 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion2 && _iterator2.return) {
                                        _iterator2.return();
                                    }
                                } finally {
                                    if (_didIteratorError2) {
                                        throw _iteratorError2;
                                    }
                                }
                            }
                        } else if (typeof displayObject[propKey] === 'function') {
                            var _displayObject;

                            (_displayObject = displayObject)[propKey].apply(_displayObject, _toConsumableArray(obj.prop[propKey]));
                        } else {
                            displayObject[propKey] = obj.prop[propKey];
                        }
                    }
                } catch (err) {
                    _didIteratorError = true;
                    _iteratorError = err;
                } finally {
                    try {
                        if (!_iteratorNormalCompletion && _iterator.return) {
                            _iterator.return();
                        }
                    } finally {
                        if (_didIteratorError) {
                            throw _iteratorError;
                        }
                    }
                }

                if (obj.type === 'text' && obj.prop.align) {
                    switch (obj.prop.align) {
                        case 'center':
                            displayObject.x = (this.width - displayObject.getBounds().width) / 2;
                            break;
                        case 'right':
                            displayObject.x = this.width - displayObject.getBounds().width;
                            break;
                        default:
                            displayObject.x = 0;
                    }
                }
            }

            if (obj.method) {
                var _iteratorNormalCompletion3 = true;
                var _didIteratorError3 = false;
                var _iteratorError3 = undefined;

                try {
                    for (var _iterator3 = Object.keys(obj.method)[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
                        var _displayObject2;

                        var _key = _step3.value;

                        (_displayObject2 = displayObject)[_key].apply(_displayObject2, _toConsumableArray(obj.method[_key]));
                    }
                } catch (err) {
                    _didIteratorError3 = true;
                    _iteratorError3 = err;
                } finally {
                    try {
                        if (!_iteratorNormalCompletion3 && _iterator3.return) {
                            _iterator3.return();
                        }
                    } finally {
                        if (_didIteratorError3) {
                            throw _iteratorError3;
                        }
                    }
                }
            }

            if (obj.event) {
                if (obj.event.handle) {
                    var type = obj.event.type || 'click';
                    displayObject.addEventListener(type, obj.event.handle);
                }
            }

            if (displayObject.getBounds()) {
                var bounds = displayObject.getBounds();
                displayObject.width = bounds.width;
                displayObject.height = bounds.height;
            }

            return displayObject;
        }
    }, {
        key: '_render',
        value: function _render() {
            var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];

            var _this4 = this;

            var parent_id = arguments[1];
            var custom = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function () {};


            if (data instanceof Object) {
                data = Array.from(data);
            }

            data.map(function (obj) {

                obj.parent_id = parent_id;

                _this4.objects[obj.id] = _this4._addObj(obj);

                if (_this4.isLog) {
                    console.group(obj.id + ':');
                    console.table({
                        x: _this4.objects[obj.id].x,
                        y: _this4.objects[obj.id].y,
                        regX: _this4.objects[obj.id].regX,
                        regY: _this4.objects[obj.id].regY,
                        scaleX: _this4.objects[obj.id].scaleX,
                        scaleY: _this4.objects[obj.id].scaleY,
                        rotation: _this4.objects[obj.id].rotation,
                        alpha: _this4.objects[obj.id].alpha,
                        visible: _this4.objects[obj.id].visible
                    });
                }

                if (parent_id) {
                    _this4.objects[parent_id].addChild(_this4.objects[obj.id]);
                } else {
                    _this4._stage.addChild(_this4.objects[obj.id]);
                }

                // 自定义属性
                if (custom) {
                    custom(_this4.objects[obj.id], obj);
                }

                if (obj.children) {
                    _this4._render(obj.children, obj.id, custom);
                }

                if (_this4.isLog) {
                    console.groupEnd();
                }
            });

            this._stage.update();
        }
    }, {
        key: '_createAnimate',
        value: function _createAnimate(displayObject) {
            var _ref2 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
                _ref2$x = _ref2.x,
                x = _ref2$x === undefined ? null : _ref2$x,
                _ref2$y = _ref2.y,
                y = _ref2$y === undefined ? null : _ref2$y,
                _ref2$scaleX = _ref2.scaleX,
                scaleX = _ref2$scaleX === undefined ? null : _ref2$scaleX,
                _ref2$scaleY = _ref2.scaleY,
                scaleY = _ref2$scaleY === undefined ? null : _ref2$scaleY,
                _ref2$skewX = _ref2.skewX,
                skewX = _ref2$skewX === undefined ? null : _ref2$skewX,
                _ref2$skewY = _ref2.skewY,
                skewY = _ref2$skewY === undefined ? null : _ref2$skewY,
                _ref2$rotation = _ref2.rotation,
                rotation = _ref2$rotation === undefined ? null : _ref2$rotation,
                _ref2$alpha = _ref2.alpha,
                alpha = _ref2$alpha === undefined ? 1 : _ref2$alpha,
                _ref2$top = _ref2.top,
                top = _ref2$top === undefined ? 0 : _ref2$top,
                _ref2$duration = _ref2.duration,
                duration = _ref2$duration === undefined ? 0 : _ref2$duration,
                _ref2$sprite = _ref2.sprite,
                sprite = _ref2$sprite === undefined ? [] : _ref2$sprite,
                _ref2$startById = _ref2.startById,
                startById = _ref2$startById === undefined ? null : _ref2$startById,
                _ref2$endById = _ref2.endById,
                endById = _ref2$endById === undefined ? null : _ref2$endById,
                _ref2$afterById = _ref2.afterById,
                afterById = _ref2$afterById === undefined ? null : _ref2$afterById,
                _ref2$musicById = _ref2.musicById,
                musicById = _ref2$musicById === undefined ? null : _ref2$musicById;

            var mapPos = (this.isVertical ? displayObject.y : displayObject.x) + _initAnimatePosition(this),
                // 对象位置
            startX = displayObject.x,
                // 动画 X 开始
            startY = displayObject.y,
                // 动画 Y 开始
            endX = x,
                // 动画 X 结束
            endY = y,
                // 动画 Y 结束
            initAlpha = displayObject.alpha,
                initScaleX = displayObject.scaleX,
                initScaleY = displayObject.scaleY,
                initSkewX = displayObject.skewX,
                initSkewY = displayObject.skewY,
                initRotation = displayObject.rotation,
                isMusic = false,
                isPlay = false;

            var animatePlayStart = 0; // 对象开始执行动画位置
            var animatePlayEnd = 0; // 对象结束执行动画位置

            if (startById) {
                animatePlayStart = this.objects[startById].animation.animatePlayStart;
            } else if (afterById) {
                animatePlayStart = this.objects[afterById].animation.animatePlayEnd;
            } else {
                if (mapPos - top >= this.mapPlay) {
                    animatePlayStart = mapPos - top - this.mapPlay;
                } else {
                    animatePlayStart = this.mapStart;
                }
            }

            if (endById && animatePlayStart < this.objects[endById].animation.animatePlayEnd) {
                animatePlayEnd = this.objects[endById].animation.animatePlayEnd;
                duration = animatePlayEnd - animatePlayStart;
            } else {
                animatePlayEnd = animatePlayStart + duration;
            }

            function _initAnimatePosition(ctx) {
                var sum = 0;

                _countSumY(displayObject);

                return sum;

                function _countSumY(displayObject) {
                    var parent = displayObject.parent;

                    if (parent && parent.parent !== null) {
                        sum += ctx.isVertical ? parent.y : parent.x;
                        _countSumY(parent);
                    }
                }
            }

            function _animate(rate) {

                var progress = rate / duration;

                if (sprite.length > 1) {
                    var length = sprite.length;
                    var durationSegment = duration / length;
                    var currentIndex = Math.min(rate / durationSegment | 0, length - 1);
                    displayObject.image = sprite[currentIndex];
                }

                if (endX || endX === 0) displayObject.x = progress * (endX - startX) + startX;
                if (endY || endY === 0) displayObject.y = progress * (endY - startY) + startY;
                if (alpha || alpha === 0) displayObject.alpha = progress * (alpha - initAlpha) + initAlpha;
                if (scaleX || scaleX === 0) displayObject.scaleX = progress * (scaleX - initScaleX) + initScaleX;
                if (scaleY || scaleY === 0) displayObject.scaleY = progress * (scaleY - initScaleY) + initScaleY;
                if (skewX || skewX === 0) displayObject.skewX = progress * (skewX - initSkewX) + initSkewX;
                if (skewY || skewY === 0) displayObject.skewY = progress * (skewY - initSkewY) + initSkewY;
                if (rotation || rotation === 0) displayObject.rotation = progress * (rotation - initRotation) + initRotation;
            }

            return {
                animatePlayStart: animatePlayStart,
                animatePlayEnd: animatePlayEnd,
                update: function update(rate) {
                    var progress = rate / duration;

                    if ((progress === 0 || progress === 1) && isPlay === false) {
                        return;
                    }

                    if (progress >= 1) {
                        progress = 1;
                        isPlay = false;
                    } else if (progress <= 0) {
                        progress = 0;
                        isPlay = false;
                    } else {
                        isPlay = true;
                    }

                    if (musicById) {
                        var music = document.getElementById(musicById);
                        if (music) {
                            if (isMusic === false) {
                                isMusic = true;
                                music.currentTime = 0;
                                music.play();
                            } else if (isMusic === true && progress === 0) {
                                music.pause();
                                isMusic = false;
                            }

                            if (music.loop && isMusic === true && progress === 1) {
                                music.pause();
                                isMusic = false;
                            }
                        }
                    }

                    _animate(rate);
                },
                set: function set(rate) {
                    if (isPlay) isPlay = false;
                    if (isMusic) isMusic = false;

                    _animate(rate);
                }
            };
        }
    }, {
        key: '_stats',
        value: function _stats() {
            this.stats = new Stats();
            this.stats.showPanel(0); // 0: fps, 1: ms, 2: mb, 3+: custom
            document.body.appendChild(this.stats.dom);
        }
    }]);

    return TimeGallery;
}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRpbWUtZ2FsbGVyeS5qcyJdLCJuYW1lcyI6WyJUaW1lR2FsbGVyeSIsIm9wdGlvbnMiLCJpZCIsImNvbnNvbGUiLCJlcnJvciIsIndpZHRoIiwid2luZG93IiwiaW5uZXJXaWR0aCIsImhlaWdodCIsImlubmVySGVpZ2h0IiwiX3N0YWdlIiwiY3JlYXRlanMiLCJTdGFnZSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJjYW52YXMiLCJfbG9hZFF1ZXVlIiwiX2lzTG9hZGluZyIsIl9pc0VuZCIsIl9kaXJHcm91cCIsImhvcml6b250YWwiLCJ2ZXJ0aWNhbCIsImlzVmVydGljYWwiLCJkaXJlY3Rpb24iLCJpc01vdmluZyIsImlzU3RhdGUiLCJpc0xvZyIsImF1dG9QbGF5IiwiYXV0b1NwZWVkIiwicmVzb3VyY2VzUGF0aCIsInJlc291cmNlcyIsInNwcml0ZXMiLCJkYXRhIiwib25Jbml0Iiwib25FbmQiLCJvblRpY2tTdGFydCIsIm9uVGlja0VuZCIsIm1hcFN0YXJ0IiwibWFwQWN0aXZlIiwibWFwRW5kIiwibWFwUGxheSIsIm9iamVjdHMiLCJhbmltYXRvcnNHcm91cCIsInRvdWNoRGF0YSIsInRvdWNoc3RhcnQiLCJ0b3VjaG1vdmUiLCJmcmljdGlvbiIsInNwZWVkIiwidG91Y2hTcGVlZCIsImlzSW5lcnRhbmNlIiwiaW5pdCIsIl9wcmVsb2FkIiwicGF0aCIsIm9uQ29tcGxldGUiLCJjaGlsZHJlbiIsIl9yZW5kZXIiLCJkaXNwbGF5T2JqZWN0Iiwib2JqIiwiYW5pbWF0aW9uIiwiX2NyZWF0ZUFuaW1hdGUiLCJwdXNoIiwibWFwIiwieSIsIngiLCJtYXBMb25nIiwiZ2V0Qm91bmRzIiwibWF4QW5pbWF0ZVBsYXlFbmQiLCJNYXRoIiwibWF4IiwiYXBwbHkiLCJpdGVtIiwiYW5pbWF0ZVBsYXlFbmQiLCJfaW5pdFRvdWNoRXZlbnQiLCJfc3RhdHMiLCJ1cGRhdGUiLCJUaWNrZXIiLCJ0aW1pbmdNb2RlIiwiUkFGIiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9vblRpY2siLCJiaW5kIiwiZm9yRWFjaCIsInNldCIsInBsYXkiLCJyZW1vdmVBbGxFdmVudExpc3RlbmVycyIsInBvcyIsImFicyIsIl91cGRhdGVBbmltYXRvcnMiLCJzdGF0cyIsImFuaW1hdGVQbGF5U3RhcnQiLCJkdXJhdGlvbiIsImUiLCJ0b3VjaGVzIiwiY2xpZW50WSIsImNsaWVudFgiLCJtYW5pZmVzdCIsIm9uUHJvZ3Jlc3MiLCJmaWxlTGlzdCIsIkFycmF5IiwiaXNBcnJheSIsImxlbmd0aCIsInNyYyIsImxvYWRlZE51bWJlciIsInByZWxvYWROdW1iZXIiLCJpbWFnZXMiLCJpIiwiaW1hZ2UiLCJJbWFnZSIsImZpbGUiLCJmaWxlVHlwZSIsIm9ubG9hZCIsInByb2dyZXNzIiwiZmxvb3IiLCJ0eXBlIiwiU2hhcGUiLCJCaXRtYXAiLCJUZXh0Iiwic2hlZXQiLCJzcHJpdGVTaGVldCIsIlNwcml0ZVNoZWV0IiwiU3ByaXRlIiwiQ29udGFpbmVyIiwibmFtZSIsInBhcmVudF9pZCIsInBhcmVudElkIiwicHJvcCIsIk9iamVjdCIsImtleXMiLCJwcm9wS2V5Iiwia2V5IiwiYWxpZ24iLCJtZXRob2QiLCJldmVudCIsImhhbmRsZSIsImJvdW5kcyIsImN1c3RvbSIsImZyb20iLCJfYWRkT2JqIiwiZ3JvdXAiLCJ0YWJsZSIsInJlZ1giLCJyZWdZIiwic2NhbGVYIiwic2NhbGVZIiwicm90YXRpb24iLCJhbHBoYSIsInZpc2libGUiLCJhZGRDaGlsZCIsImdyb3VwRW5kIiwic2tld1giLCJza2V3WSIsInRvcCIsInNwcml0ZSIsInN0YXJ0QnlJZCIsImVuZEJ5SWQiLCJhZnRlckJ5SWQiLCJtdXNpY0J5SWQiLCJtYXBQb3MiLCJfaW5pdEFuaW1hdGVQb3NpdGlvbiIsInN0YXJ0WCIsInN0YXJ0WSIsImVuZFgiLCJlbmRZIiwiaW5pdEFscGhhIiwiaW5pdFNjYWxlWCIsImluaXRTY2FsZVkiLCJpbml0U2tld1giLCJpbml0U2tld1kiLCJpbml0Um90YXRpb24iLCJpc011c2ljIiwiaXNQbGF5IiwiY3R4Iiwic3VtIiwiX2NvdW50U3VtWSIsInBhcmVudCIsIl9hbmltYXRlIiwicmF0ZSIsImR1cmF0aW9uU2VnbWVudCIsImN1cnJlbnRJbmRleCIsIm1pbiIsIm11c2ljIiwiY3VycmVudFRpbWUiLCJwYXVzZSIsImxvb3AiLCJTdGF0cyIsInNob3dQYW5lbCIsImJvZHkiLCJhcHBlbmRDaGlsZCIsImRvbSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQXVCTUEsVztBQUVGLHlCQUFhQyxPQUFiLEVBQXNCO0FBQUE7O0FBRWxCLFlBQUlBLFFBQVFDLEVBQVIsS0FBZSxFQUFuQixFQUF1QjtBQUNuQkMsb0JBQVFDLEtBQVIsQ0FBYyxjQUFkO0FBQ0g7O0FBRUQsYUFBS0MsS0FBTCxHQUFhSixRQUFRSSxLQUFSLElBQWlCQyxPQUFPQyxVQUFyQztBQUNBLGFBQUtDLE1BQUwsR0FBY1AsUUFBUU8sTUFBUixJQUFrQkYsT0FBT0csV0FBdkM7QUFDQSxhQUFLQyxNQUFMLEdBQWMsSUFBSUMsU0FBU0MsS0FBYixDQUFtQkMsU0FBU0MsY0FBVCxDQUF3QmIsUUFBUUMsRUFBaEMsQ0FBbkIsQ0FBZDtBQUNBLGFBQUtRLE1BQUwsQ0FBWUssTUFBWixDQUFtQlYsS0FBbkIsR0FBMkIsS0FBS0EsS0FBaEM7QUFDQSxhQUFLSyxNQUFMLENBQVlLLE1BQVosQ0FBbUJQLE1BQW5CLEdBQTRCLEtBQUtBLE1BQWpDO0FBQ0EsYUFBS1EsVUFBTCxHQUFrQixJQUFsQjtBQUNBLGFBQUtDLFVBQUwsR0FBa0IsS0FBbEI7QUFDQSxhQUFLQyxNQUFMLEdBQWMsS0FBZDtBQUNBLGFBQUtDLFNBQUwsR0FBaUI7QUFDYkMsd0JBQVksWUFEQztBQUViQyxzQkFBVTtBQUZHLFNBQWpCOztBQUtBLGFBQUtDLFVBQUwsR0FBa0IsQ0FBQ3JCLFFBQVFzQixTQUFSLElBQXFCLEtBQUtKLFNBQUwsQ0FBZUUsUUFBckMsTUFBbUQsS0FBS0YsU0FBTCxDQUFlRSxRQUFwRjtB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QUF3QztBQUMzQ3FFLHNDQUFNRSxLQUFOO0FBQ0FiLDBDQUFVLEtBQVY7QUFDSDs7QUFFRCxnQ0FBSVcsTUFBTUcsSUFBTixJQUFjZCxZQUFZLElBQTFCLElBQWtDMUQsYUFBYSxDQUFuRCxFQUFzRDtBQUNsRHFFLHNDQUFNRSxLQUFOO0FBQ0FiLDBDQUFVLEtBQVY7QUFDSDtBQUNKO0FBQ0o7O0FBRURNLDZCQUFTQyxJQUFUO0FBQ0gsaUJBeENFO0FBeUNIOUYsbUJBekNHLGVBeUNDOEYsSUF6Q0QsRUF5Q087QUFDTix3QkFBSU4sTUFBSixFQUFZQSxTQUFTLEtBQVQ7QUFDWix3QkFBSUQsT0FBSixFQUFhQSxVQUFVLEtBQVY7O0FBRWJNLDZCQUFTQyxJQUFUO0FBQ0g7QUE5Q0UsYUFBUDtBQWdESDs7O2lDQUVTO0FBQ04saUJBQUt4RixLQUFMLEdBQWEsSUFBSWdHLEtBQUosRUFBYjtBQUNBLGlCQUFLaEcsS0FBTCxDQUFXaUcsU0FBWCxDQUFxQixDQUFyQixFQUZNLENBRW1CO0FBQ3pCNUsscUJBQVM2SyxJQUFULENBQWNDLFdBQWQsQ0FBMEIsS0FBS25HLEtBQUwsQ0FBV29HLEdBQXJDO0FBQ0giLCJmaWxlIjoidGltZS1nYWxsZXJ5Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogIEBXaWR0aDog55S75biD5a69XG4gKiAgQEhlaWdodDog55S75biD6auYXG4gKiAgQGlzU3RhdGU6IOaYr+WQpuWQr+WKqCBTdGFnZS5qcyDmtYvor5VGUFMsIOS+nei1liBzdGFnZS5qc1xuICogIEBpc0xvZzog5piv5ZCm5omT5Y2w5pWw5o2u57uT5p6EXG4gKiAgQGRpcmVjdGlvbjog5Y+v6K6+572u5rC05bmzKGhvcml6b250YWwp5oiW5Z6C55u0KHZlcnRpY2FsKVxuICogIEByZXNvdXJjZXNQYXRoOiDlm77niYfotYTmupDliqDovb3nmoTpu5jorqTot6/lirJcbiAqICBAcmVzb3VyY2VzOiDlm77niYfotYTmupBcbiAqICBAc3ByaXRlczog6Ieq5a6a5LmJ6Zuq56Kn5Zu+5pWw5o2u5pWw57uE77yM5pa55L6/5Yib5bu65pWw5o2u55qE5pe25YCZ5Y+v6ZqP5pe26LCD55So6Zuq56Kn5Zu+XG4gKiAgQGRhdGE6IOWIm+W7uueUu+W4g+aVsOaNrlxuICogIEBvbkluaXQ6IOWIneWni+WMluWQjueahOWbnuiwg1xuICogIEBvbkVuZDog57uT5p2f5ZCO55qE5Zue6LCDXG4gKiAgQG9uVGlja1N0YXJ0OiDmr4/kuIDluKfnmoTlvIDlp4vliY3lm57osINcbiAqICBAb25UaWNrRW5kOiDmr4/kuIDluKfnmoTnu5PmnZ/lkI7lm57osINcbiAqICBAbWFwU3RhcnQ6IOWumuS5ieeUu+W4g+Wni+eCueS9jee9rlxuICogIEBtYXBBY3RpdmU6IOWumuS5ieeUu+W4g+W9k+WJjeeahOaSreaUvueahOS9jee9ru+8iOWPr+aWueS+v+a1i+ivle+8iVxuICogIEBtYXBFbmQ6IOeUu+W4g+m7mOiupOe7k+adn+S9jee9ru+8jOm7mOiupOaYryBhbmltYXRlUGxheUVuZCDmnIDlpKflgLzmiJblnLDlm77nmoTpq5jluqZcbiAqICBAbWFwUGxheTog5a6a5LmJ55S75biD5pKt5pS+5Yqo55S755qE5L2N572u77yI6buY6K6k5YWD57Sg5YaN5bGP5bmV5bqV6YOo55qE5L2N572u5byA5aeL5pKt5pS+5Yqo55S777yJXG4gKiAgQHRvdWNoU3BlZWQ6IOWumuS5ieeUqOaIt+a7keWKqOmAn+W6pu+8jOi2iuWkp++8jOa7keWKqOeahOmAn+W6pui2iuW/q1xuICogIEBhdXRvUGxheTog5piv5ZCm6Ieq5Yqo5pKt5pS+XG4gKiAgQGF1dG9TcGVlZDog6Ieq5Yqo5pKt5pS+6YCf5bqmXG4gKi9cblxuY2xhc3MgVGltZUdhbGxlcnkge1xuXG4gICAgY29uc3RydWN0b3IgKG9wdGlvbnMpIHtcblxuICAgICAgICBpZiAob3B0aW9ucy5pZCA9PT0gJycpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0lEIG5vdCBleGlzdCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy53aWR0aCA9IG9wdGlvbnMud2lkdGggfHwgd2luZG93LmlubmVyV2lkdGg7XG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQgfHwgd2luZG93LmlubmVySGVpZ2h0O1xuICAgICAgICB0aGlzLl9zdGFnZSA9IG5ldyBjcmVhdGVqcy5TdGFnZShkb2N1bWVudC5nZXRFbGVtZW50QnlJZChvcHRpb25zLmlkKSk7XG4gICAgICAgIHRoaXMuX3N0YWdlLmNhbnZhcy53aWR0aCA9IHRoaXMud2lkdGg7XG4gICAgICAgIHRoaXMuX3N0YWdlLmNhbnZhcy5oZWlnaHQgPSB0aGlzLmhlaWdodDtcbiAgICAgICAgdGhpcy5fbG9hZFF1ZXVlID0gbnVsbDtcbiAgICAgICAgdGhpcy5faXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX2lzRW5kID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX2Rpckdyb3VwID0ge1xuICAgICAgICAgICAgaG9yaXpvbnRhbDogJ2hvcml6b250YWwnLFxuICAgICAgICAgICAgdmVydGljYWw6ICd2ZXJ0aWNhbCdcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmlzVmVydGljYWwgPSAob3B0aW9ucy5kaXJlY3Rpb24gfHwgdGhpcy5fZGlyR3JvdXAudmVydGljYWwpID09PSB0aGlzLl9kaXJHcm91cC52ZXJ0aWNhbDtcbiAgICAgICAgdGhpcy5pc01vdmluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmlzU3RhdGUgPSBvcHRpb25zLmlzU3RhdGUgfHwgZmFsc2U7XG4gICAgICAgIHRoaXMuaXNMb2cgPSBvcHRpb25zLmlzTG9nIHx8IGZhbHNlO1xuXG4gICAgICAgIHRoaXMuYXV0b1BsYXkgPSBvcHRpb25zLmF1dG9QbGF5IHx8IGZhbHNlO1xuICAgICAgICB0aGlzLmF1dG9TcGVlZCA9IG9wdGlvbnMuYXV0b1NwZWVkIHx8IDE7XG5cbiAgICAgICAgdGhpcy5yZXNvdXJjZXNQYXRoID0gb3B0aW9ucy5yZXNvdXJjZXNQYXRoIHx8ICcnO1xuICAgICAgICB0aGlzLnJlc291cmNlcyA9IG9wdGlvbnMucmVzb3VyY2VzIHx8IFtdO1xuICAgICAgICB0aGlzLnNwcml0ZXMgPSBvcHRpb25zLnNwcml0ZXMgfHwge307XG4gICAgICAgIHRoaXMuZGF0YSA9IG9wdGlvbnMuZGF0YSB8fCBbXTtcblxuICAgICAgICB0aGlzLm9uSW5pdCA9IG9wdGlvbnMub25Jbml0IHx8IG51bGw7XG4gICAgICAgIHRoaXMub25FbmQgPSBvcHRpb25zLm9uRW5kIHx8IG51bGw7XG4gICAgICAgIHRoaXMub25UaWNrU3RhcnQgPSBvcHRpb25zLm9uVGlja1N0YXJ0IHx8IG51bGw7XG4gICAgICAgIHRoaXMub25UaWNrRW5kID0gb3B0aW9ucy5vblRpY2tFbmQgfHwgbnVsbDtcblxuICAgICAgICB0aGlzLm1hcFN0YXJ0ID0gb3B0aW9ucy5tYXBTdGFydCB8fCAwO1xuICAgICAgICB0aGlzLm1hcEFjdGl2ZSA9IG9wdGlvbnMubWFwQWN0aXZlIHx8IDA7XG4gICAgICAgIHRoaXMubWFwRW5kID0gb3B0aW9ucy5tYXBFbmQgfHwgMDtcbiAgICAgICAgdGhpcy5tYXBQbGF5ID0gb3B0aW9ucy5tYXBQbGF5IHx8ICh0aGlzLmlzVmVydGljYWw/IHRoaXMuaGVpZ2h0IDogdGhpcy53aWR0aCk7XG5cbiAgICAgICAgdGhpcy5vYmplY3RzID0ge307XG4gICAgICAgIHRoaXMuYW5pbWF0b3JzR3JvdXAgPSBbXTsgICAgICAgICAgICAgIC8vIOaJp+ihjOWKqOeUu+eahOaVsOe7hFxuICAgICAgICB0aGlzLnRvdWNoRGF0YSA9IHtcbiAgICAgICAgICAgIHRvdWNoc3RhcnQ6IDAsXHRcdFx0ICAgICAgICAgICAvLyBUb3VjaFN0YXJ0IOWIneWniyBZIOS9jee9rlxuICAgICAgICAgICAgdG91Y2htb3ZlOiAwLCAgICAgICAgICAgICAgICAgICAgICAvLyBUb3VjaE1vdmUgIOWIneWniyBZIOi3neemu1xuICAgICAgICAgICAgZnJpY3Rpb24gOiAwLjksXHRcdCAgICAgICAgICAgICAgIC8vIOaRqeaTpuWAvFxuICAgICAgICAgICAgc3BlZWQ6IG9wdGlvbnMudG91Y2hTcGVlZCB8fCAxLCAgICAvLyBUb3VjaCDmu5HliqjpgJ/luqZcbiAgICAgICAgICAgIGlzSW5lcnRhbmNlOiBmYWxzZSAgICAgICAgICAgICAgICAgLy8g5oOv5oCnXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5pbml0KCk7XG4gICAgfVxuXG4gICAgaW5pdCgpIHtcbiAgICAgICAgdGhpcy5fcHJlbG9hZCh0aGlzLnJlc291cmNlcywge1xuICAgICAgICAgICAgcGF0aDogdGhpcy5yZXNvdXJjZXNQYXRoLFxuICAgICAgICAgICAgb25Db21wbGV0ZTogKCkgPT4ge1xuXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLnNwcml0ZXMgPT09ICdmdW5jdGlvbicpIHRoaXMuc3ByaXRlcyA9IHRoaXMuc3ByaXRlcyh0aGlzKTtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMuZGF0YSA9PT0gJ2Z1bmN0aW9uJykgdGhpcy5kYXRhID0gdGhpcy5kYXRhKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICdtYXAnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IHRoaXMuZGF0YVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgICAgIC8vIOa4suafk+WbvuWDj+aVsOaNrlxuICAgICAgICAgICAgICAgIHRoaXMuX3JlbmRlcihkYXRhLCBudWxsLCAoZGlzcGxheU9iamVjdCwgb2JqKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkaXNwbGF5T2JqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmFuaW1hdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlPYmplY3QuYW5pbWF0aW9uID0gdGhpcy5fY3JlYXRlQW5pbWF0ZShkaXNwbGF5T2JqZWN0LCBvYmouYW5pbWF0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFuaW1hdG9yc0dyb3VwLnB1c2goe2Rpc3BsYXlPYmplY3R9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5tYXAgPSB0aGlzLm9iamVjdHNbJ21hcCddO1xuXG4gICAgICAgICAgICAgICAgbGV0IG1hcEFjdGl2ZSA9IHRoaXMubWFwQWN0aXZlPyAtdGhpcy5tYXBBY3RpdmUgOiAtdGhpcy5tYXBTdGFydDtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzVmVydGljYWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXAueSA9IG1hcEFjdGl2ZVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWFwLnggPSBtYXBBY3RpdmU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLm1hcEVuZCkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgbWFwTG9uZztcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNWZXJ0aWNhbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWFwTG9uZyA9IHRoaXMubWFwLmdldEJvdW5kcygpLmhlaWdodCArIHRoaXMubWFwLmdldEJvdW5kcygpLnkgLSB0aGlzLmhlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcExvbmcgPSB0aGlzLm1hcC5nZXRCb3VuZHMoKS53aWR0aCArIHRoaXMubWFwLmdldEJvdW5kcygpLnggLSB0aGlzLndpZHRoO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGxldCBtYXhBbmltYXRlUGxheUVuZCA9IE1hdGgubWF4LmFwcGx5KE1hdGgsIHRoaXMuYW5pbWF0b3JzR3JvdXAubWFwKChpdGVtKSA9PiB7cmV0dXJuIGl0ZW0uZGlzcGxheU9iamVjdC5hbmltYXRpb24uYW5pbWF0ZVBsYXlFbmR9KSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWFwRW5kID0gTWF0aC5tYXgobWFwTG9uZywgbWF4QW5pbWF0ZVBsYXlFbmQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIOWIneWni+WMlua7keWKqOS6i+S7tlxuICAgICAgICAgICAgICAgIHRoaXMuX2luaXRUb3VjaEV2ZW50KCk7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vbkluaXQpIHRoaXMub25Jbml0KCk7XG5cbiAgICAgICAgICAgICAgICAvLyDmmK/lkKbmiZPljbAgRlBTIOeKtuaAge+8jOS+nei1liBzdGF0ZS5qc1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzU3RhdGUpIHRoaXMuX3N0YXRzKCk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLl9zdGFnZS51cGRhdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgY3JlYXRlanMuVGlja2VyLnRpbWluZ01vZGUgPSBjcmVhdGVqcy5UaWNrZXIuUkFGO1xuICAgIH1cblxuICAgIHBsYXkoKSB7XG4gICAgICAgIGNyZWF0ZWpzLlRpY2tlci5hZGRFdmVudExpc3RlbmVyKCd0aWNrJywgdGhpcy5fb25UaWNrLmJpbmQodGhpcykpO1xuICAgIH1cbiAgICBcbiAgICByZXBsYXkoKSB7XG4gICAgICAgIHRoaXMuX2lzRW5kID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy50b3VjaERhdGEudG91Y2hzdGFydCA9IDA7XG4gICAgICAgIHRoaXMudG91Y2hEYXRhLnRvdWNobW92ZSA9IDA7XG4gICAgICAgIHRoaXMudG91Y2hEYXRhLmlzSW5lcnRhbmNlID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKHRoaXMuaXNWZXJ0aWNhbCkge1xuICAgICAgICAgICAgdGhpcy5tYXAueSA9IC10aGlzLm1hcFN0YXJ0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5tYXAueCA9IC10aGlzLm1hcFN0YXJ0O1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5hbmltYXRvcnNHcm91cC5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICBpdGVtLmRpc3BsYXlPYmplY3QuYW5pbWF0aW9uLnNldCgwKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5fc3RhZ2UudXBkYXRlKCk7XG5cbiAgICAgICAgdGhpcy5wbGF5KCk7XG4gICAgfVxuXG4gICAgc3RvcCgpIHtcbiAgICAgICAgY3JlYXRlanMuVGlja2VyLnJlbW92ZUFsbEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgfVxuXG4gICAgZ2V0SW1hZ2UoaWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xvYWRRdWV1ZVtpZF07XG4gICAgfVxuXG4gICAgX29uVGljaygpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9pc0xvYWRpbmcgJiYgdGhpcy5tYXApIHtcblxuICAgICAgICAgICAgaWYgKHRoaXMuYXV0b1BsYXkgfHwgdGhpcy5pc01vdmluZykge1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMub25UaWNrU3RhcnQpIHRoaXMub25UaWNrU3RhcnQodGhpcyk7XG5cbiAgICAgICAgICAgICAgICBsZXQgcG9zO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYXV0b1BsYXkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNWZXJ0aWNhbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXAueSAtPSB0aGlzLmF1dG9TcGVlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IC10aGlzLm1hcC55O1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXAueCAtPSB0aGlzLmF1dG9TcGVlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IC10aGlzLm1hcC54O1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudG91Y2hEYXRhLnRvdWNobW92ZSAhPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50b3VjaERhdGEudG91Y2hzdGFydCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRvdWNoRGF0YS50b3VjaG1vdmUgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50b3VjaERhdGEuaXNJbmVydGFuY2UgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNNb3ZpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5pc01vdmluZykge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIOWmguaenOaYr+aDr+aAp1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50b3VjaERhdGEuaXNJbmVydGFuY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOaDr+aAp+WHj+mAn1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50b3VjaERhdGEudG91Y2htb3ZlICo9IHRoaXMudG91Y2hEYXRhLmZyaWN0aW9uO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnModGhpcy50b3VjaERhdGEudG91Y2htb3ZlKSA8PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50b3VjaERhdGEudG91Y2hzdGFydCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50b3VjaERhdGEudG91Y2htb3ZlID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRvdWNoRGF0YS5pc0luZXJ0YW5jZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXNNb3ZpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIOagueaNrua7keWKqOeahOS9jee9ruiusOW9leWKqOeUu+aJp+ihjFxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1ZlcnRpY2FsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1hcC55ICs9IHRoaXMudG91Y2hEYXRhLnRvdWNobW92ZSAqIHRoaXMudG91Y2hEYXRhLnNwZWVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gLXRoaXMubWFwLnk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1hcC54ICs9IHRoaXMudG91Y2hEYXRhLnRvdWNobW92ZSAqIHRoaXMudG91Y2hEYXRhLnNwZWVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9zID0gLXRoaXMubWFwLng7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAocG9zIDwgdGhpcy5tYXBTdGFydCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1ZlcnRpY2FsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1hcC55ID0gLXRoaXMubWFwU3RhcnQ7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1hcC54ID0gLXRoaXMubWFwU3RhcnQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAocG9zID4gdGhpcy5tYXBFbmQpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNFbmQpIHJldHVybjtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc0VuZCA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNWZXJ0aWNhbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXAueSA9IC10aGlzLm1hcEVuZDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWFwLnggPSAtdGhpcy5tYXBFbmQ7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vbkVuZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkVuZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdGhpcy5tYXBBY3RpdmUgPSB0aGlzLmlzVmVydGljYWw/IC10aGlzLm1hcC55IDogLXRoaXMubWFwLng7XG5cbiAgICAgICAgICAgICAgICB0aGlzLl91cGRhdGVBbmltYXRvcnMoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuaXNTdGF0ZSkge1xuICAgICAgICAgICAgdGhpcy5zdGF0cy51cGRhdGUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIF91cGRhdGVBbmltYXRvcnMoKSB7XG4gICAgICAgIGxldCBwb3MgPSB0aGlzLmlzVmVydGljYWw/IC10aGlzLm1hcC55IDogLXRoaXMubWFwLng7XG5cbiAgICAgICAgdGhpcy5hbmltYXRvcnNHcm91cC5tYXAoKG9iaikgPT4ge1xuICAgICAgICAgICAgbGV0IGRpc3BsYXlPYmplY3QgPSBvYmouZGlzcGxheU9iamVjdDtcbiAgICAgICAgICAgIGxldCBhbmltYXRlUGxheVN0YXJ0ID0gZGlzcGxheU9iamVjdC5hbmltYXRpb24uYW5pbWF0ZVBsYXlTdGFydDtcbiAgICAgICAgICAgIGxldCBhbmltYXRlUGxheUVuZCAgID0gZGlzcGxheU9iamVjdC5hbmltYXRpb24uYW5pbWF0ZVBsYXlFbmQ7XG5cbiAgICAgICAgICAgIGlmIChwb3MgPj0gYW5pbWF0ZVBsYXlTdGFydCAmJiBwb3MgPCBhbmltYXRlUGxheUVuZCApIHtcbiAgICAgICAgICAgICAgICBsZXQgZHVyYXRpb24gPSBNYXRoLmFicyhwb3MgLSBhbmltYXRlUGxheVN0YXJ0KTtcbiAgICAgICAgICAgICAgICBkaXNwbGF5T2JqZWN0LmFuaW1hdGlvbi51cGRhdGUoZHVyYXRpb24pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwb3MgPCBhbmltYXRlUGxheVN0YXJ0KSB7XG4gICAgICAgICAgICAgICAgZGlzcGxheU9iamVjdC5hbmltYXRpb24udXBkYXRlKDApO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwb3MgPiBhbmltYXRlUGxheUVuZCkge1xuICAgICAgICAgICAgICAgIGRpc3BsYXlPYmplY3QuYW5pbWF0aW9uLnVwZGF0ZShhbmltYXRlUGxheUVuZCAtIGFuaW1hdGVQbGF5U3RhcnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAodGhpcy5vblRpY2tFbmQpIHRoaXMub25UaWNrRW5kKHRoaXMpO1xuXG4gICAgICAgIHRoaXMuX3N0YWdlLnVwZGF0ZSgpO1xuICAgIH1cblxuICAgIC8vIOWIneWni+WMluaJi+WKv1xuICAgIF9pbml0VG91Y2hFdmVudCgpIHtcblxuICAgICAgICB0aGlzLl9zdGFnZS5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIChlKSA9PiB7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmF1dG9QbGF5KSByZXR1cm47XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmlzVmVydGljYWwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRvdWNoRGF0YS50b3VjaHN0YXJ0ID0gZS50b3VjaGVzWzBdLmNsaWVudFk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudG91Y2hEYXRhLnRvdWNoc3RhcnQgPSBlLnRvdWNoZXNbMF0uY2xpZW50WDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy50b3VjaERhdGEuaXNJbmVydGFuY2UgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuaXNNb3ZpbmcgPSBmYWxzZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5fc3RhZ2UuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIChlKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5pc1ZlcnRpY2FsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50b3VjaERhdGEudG91Y2htb3ZlID0gZS50b3VjaGVzWzBdLmNsaWVudFkgLSB0aGlzLnRvdWNoRGF0YS50b3VjaHN0YXJ0O1xuICAgICAgICAgICAgICAgIHRoaXMudG91Y2hEYXRhLnRvdWNoc3RhcnQgPSBlLnRvdWNoZXNbMF0uY2xpZW50WTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy50b3VjaERhdGEudG91Y2htb3ZlID0gZS50b3VjaGVzWzBdLmNsaWVudFggLSB0aGlzLnRvdWNoRGF0YS50b3VjaHN0YXJ0O1xuICAgICAgICAgICAgICAgIHRoaXMudG91Y2hEYXRhLnRvdWNoc3RhcnQgPSBlLnRvdWNoZXNbMF0uY2xpZW50WDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuaXNNb3ZpbmcgPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLl9zdGFnZS5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCAoKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5hdXRvUGxheSkgcmV0dXJuO1xuICAgICAgICAgICAgdGhpcy50b3VjaERhdGEuaXNJbmVydGFuY2UgPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgIH1cblxuICAgIF9wcmVsb2FkKG1hbmlmZXN0ID0gW10sIHsgb25Db21wbGV0ZSA9ICgpID0+IHt9LCBvblByb2dyZXNzID0gKCkgPT4ge30sIHBhdGggPSAnJ30gPSB7fSkge1xuXG4gICAgICAgIHRoaXMuX2lzTG9hZGluZyA9IHRydWU7XG5cbiAgICAgICAgbGV0IGZpbGVMaXN0ID0gbnVsbDtcblxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShtYW5pZmVzdCkpIHtcbiAgICAgICAgICAgIGlmIChtYW5pZmVzdC5sZW5ndGggPT09IDApIHJldHVybjtcbiAgICAgICAgICAgIGZpbGVMaXN0ID0gbWFuaWZlc3Q7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mKG1hbmlmZXN0KSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGZpbGVMaXN0ID0gW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgc3JjOiBtYW5pZmVzdCxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IG1hbmlmZXN0XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YobWFuaWZlc3QpID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgaWYgKCFtYW5pZmVzdC5pZCkge1xuICAgICAgICAgICAgICAgIG1hbmlmZXN0LmlkID0gbWFuaWZlc3Quc3JjO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZmlsZUxpc3QgPSBbbWFuaWZlc3RdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGxvYWRlZE51bWJlciA9IDA7XG4gICAgICAgIGxldCBwcmVsb2FkTnVtYmVyID0gZmlsZUxpc3QubGVuZ3RoO1xuICAgICAgICBsZXQgaW1hZ2VzID0ge307XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwcmVsb2FkTnVtYmVyOyBpKyspIHtcbiAgICAgICAgICAgIGxldCBpbWFnZSA9IG5ldyBJbWFnZSgpO1xuICAgICAgICAgICAgbGV0IGZpbGUgPSBmaWxlTGlzdFtpXTtcbiAgICAgICAgICAgIGxldCBmaWxlVHlwZSA9IHR5cGVvZihmaWxlKTtcbiAgICAgICAgICAgIGxldCBzcmMgPSAnJztcblxuICAgICAgICAgICAgaWYgKGZpbGVUeXBlID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgIHNyYyA9IGZpbGUuc3JjO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChmaWxlVHlwZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBzcmMgPSBmaWxlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpbWFnZS5zcmMgPSBwYXRoICsgc3JjO1xuICAgICAgICAgICAgaW1hZ2Uub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChmaWxlLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgIGltYWdlc1tmaWxlLmlkXSA9IGltYWdlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGltYWdlc1tzcmNdID0gaW1hZ2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxvYWRlZE51bWJlcisrO1xuXG4gICAgICAgICAgICAgICAgbGV0IHByb2dyZXNzID0gTWF0aC5mbG9vcihsb2FkZWROdW1iZXIvcHJlbG9hZE51bWJlciAqIDEwMCk7XG4gICAgICAgICAgICAgICAgb25Qcm9ncmVzcyhwcm9ncmVzcyk7XG5cbiAgICAgICAgICAgICAgICBpZiAocHJvZ3Jlc3MgPj0gMTAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9sb2FkUXVldWUgPSBpbWFnZXM7XG4gICAgICAgICAgICAgICAgICAgIG9uQ29tcGxldGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8g5Z+65LqOIFByZWxvYWRKc1xuICAgICAgICAvLyB0aGlzLl9sb2FkUXVldWUgPSBuZXcgY3JlYXRlanMuTG9hZFF1ZXVlKHRydWUsIHBhdGgpO1xuICAgICAgICAvL1xuICAgICAgICAvLyBpZiAocHJvZ3Jlc3MpIHRoaXMuX2xvYWRRdWV1ZS5vbigncHJvZ3Jlc3MnLCBlID0+IG9uUHJvZ3Jlc3MoZSkpO1xuICAgICAgICAvL1xuICAgICAgICAvLyB0aGlzLl9sb2FkUXVldWUub24oJ2NvbXBsZXRlJywgZSA9PiB7XG4gICAgICAgIC8vICAgICB0aGlzLl9pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgLy8gICAgIGlmIChvbkNvbXBsZXRlKSBvbkNvbXBsZXRlKGUpO1xuICAgICAgICAvLyB9KTtcbiAgICAgICAgLy9cbiAgICAgICAgLy8gdGhpcy5fbG9hZFF1ZXVlLmxvYWRNYW5pZmVzdChsb2FkTWFuaWZlc3QpO1xuICAgIH1cblxuICAgIF9hZGRPYmoob2JqID0ge30pIHtcblxuICAgICAgICBsZXQgZGlzcGxheU9iamVjdCA9IG51bGw7XG5cbiAgICAgICAgc3dpdGNoIChvYmoudHlwZSkge1xuICAgICAgICAgICAgY2FzZSAnc2hhcGUnOlxuICAgICAgICAgICAgICAgIGRpc3BsYXlPYmplY3QgPSBuZXcgY3JlYXRlanMuU2hhcGUoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2JpdG1hcCc6XG4gICAgICAgICAgICAgICAgaWYgKG9iai5pbWFnZSkge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5T2JqZWN0ID0gbmV3IGNyZWF0ZWpzLkJpdG1hcChvYmouaW1hZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3RleHQnOlxuICAgICAgICAgICAgICAgIGRpc3BsYXlPYmplY3QgPSBuZXcgY3JlYXRlanMuVGV4dCgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnc3ByaXRlJzpcbiAgICAgICAgICAgICAgICBpZiAob2JqLnNoZWV0KSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBzcHJpdGVTaGVldCA9IG5ldyBjcmVhdGVqcy5TcHJpdGVTaGVldChvYmouc2hlZXQpO1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5T2JqZWN0ID0gbmV3IGNyZWF0ZWpzLlNwcml0ZShzcHJpdGVTaGVldCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBkaXNwbGF5T2JqZWN0ID0gbmV3IGNyZWF0ZWpzLkNvbnRhaW5lcigpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9iai50eXBlKSB7XG4gICAgICAgICAgICBkaXNwbGF5T2JqZWN0LnR5cGUgPSBvYmoudHlwZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRpc3BsYXlPYmplY3QudHlwZSA9ICdjb250YWluZXInO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9iai5pZCkgZGlzcGxheU9iamVjdC5uYW1lID0gb2JqLmlkO1xuXG4gICAgICAgIGlmIChvYmoucGFyZW50X2lkKSBkaXNwbGF5T2JqZWN0LnBhcmVudElkID0gb2JqLnBhcmVudF9pZDtcblxuICAgICAgICBpZiAob2JqLnByb3ApIHtcbiAgICAgICAgICAgIGZvciAobGV0IHByb3BLZXkgb2YgT2JqZWN0LmtleXMob2JqLnByb3ApKSB7XG4gICAgICAgICAgICAgICAgLy8g5Yik5pat5bGe5oCn57G75Z6LXG4gICAgICAgICAgICAgICAgaWYgKGRpc3BsYXlPYmplY3RbcHJvcEtleV0gaW5zdGFuY2VvZiBPYmplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQga2V5IG9mIE9iamVjdC5rZXlzKG9iai5wcm9wW3Byb3BLZXldKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBkaXNwbGF5T2JqZWN0W3Byb3BLZXldW2tleV0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5T2JqZWN0W3Byb3BLZXldW2tleV0oLi4ub2JqLnByb3BbcHJvcEtleV1ba2V5XSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlPYmplY3RbcHJvcEtleV1ba2V5XSA9IG9iai5wcm9wW3Byb3BLZXldW2tleV07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBkaXNwbGF5T2JqZWN0W3Byb3BLZXldID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlPYmplY3RbcHJvcEtleV0oLi4ub2JqLnByb3BbcHJvcEtleV0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlPYmplY3RbcHJvcEtleV0gPSBvYmoucHJvcFtwcm9wS2V5XTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvYmoudHlwZSA9PT0gJ3RleHQnICYmIG9iai5wcm9wLmFsaWduKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChvYmoucHJvcC5hbGlnbikge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdjZW50ZXInOlxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU9iamVjdC54ID0gKHRoaXMud2lkdGggLSBkaXNwbGF5T2JqZWN0LmdldEJvdW5kcygpLndpZHRoKS8yO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3JpZ2h0JzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlPYmplY3QueCA9IHRoaXMud2lkdGggLSBkaXNwbGF5T2JqZWN0LmdldEJvdW5kcygpLndpZHRoO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5T2JqZWN0LnggPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvYmoubWV0aG9kKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBrZXkgb2YgT2JqZWN0LmtleXMob2JqLm1ldGhvZCkpIHtcbiAgICAgICAgICAgICAgICBkaXNwbGF5T2JqZWN0W2tleV0oLi4ub2JqLm1ldGhvZFtrZXldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvYmouZXZlbnQpIHtcbiAgICAgICAgICAgIGlmIChvYmouZXZlbnQuaGFuZGxlKSB7XG4gICAgICAgICAgICAgICAgbGV0IHR5cGUgPSBvYmouZXZlbnQudHlwZSB8fCAnY2xpY2snO1xuICAgICAgICAgICAgICAgIGRpc3BsYXlPYmplY3QuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBvYmouZXZlbnQuaGFuZGxlKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRpc3BsYXlPYmplY3QuZ2V0Qm91bmRzKCkpIHtcbiAgICAgICAgICAgIGxldCBib3VuZHMgPSBkaXNwbGF5T2JqZWN0LmdldEJvdW5kcygpO1xuICAgICAgICAgICAgZGlzcGxheU9iamVjdC53aWR0aCA9IGJvdW5kcy53aWR0aDtcbiAgICAgICAgICAgIGRpc3BsYXlPYmplY3QuaGVpZ2h0ID0gYm91bmRzLmhlaWdodDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkaXNwbGF5T2JqZWN0O1xuXG4gICAgfVxuXG4gICAgX3JlbmRlcihkYXRhID0gW10sIHBhcmVudF9pZCwgY3VzdG9tID0gKCkgPT4ge30pIHtcblxuICAgICAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIE9iamVjdCkge1xuICAgICAgICAgICAgZGF0YSA9IEFycmF5LmZyb20oZGF0YSlcbiAgICAgICAgfVxuXG4gICAgICAgIGRhdGEubWFwKChvYmopID0+IHtcblxuICAgICAgICAgICAgb2JqLnBhcmVudF9pZCA9IHBhcmVudF9pZDtcblxuICAgICAgICAgICAgdGhpcy5vYmplY3RzW29iai5pZF0gPSB0aGlzLl9hZGRPYmoob2JqKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuaXNMb2cpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmdyb3VwKG9iai5pZCArICc6Jyk7XG4gICAgICAgICAgICAgICAgY29uc29sZS50YWJsZSh7XG4gICAgICAgICAgICAgICAgICAgIHggOiB0aGlzLm9iamVjdHNbb2JqLmlkXS54LFxuICAgICAgICAgICAgICAgICAgICB5IDogdGhpcy5vYmplY3RzW29iai5pZF0ueSxcbiAgICAgICAgICAgICAgICAgICAgcmVnWCA6IHRoaXMub2JqZWN0c1tvYmouaWRdLnJlZ1gsXG4gICAgICAgICAgICAgICAgICAgIHJlZ1kgOiB0aGlzLm9iamVjdHNbb2JqLmlkXS5yZWdZLFxuICAgICAgICAgICAgICAgICAgICBzY2FsZVggOiB0aGlzLm9iamVjdHNbb2JqLmlkXS5zY2FsZVgsXG4gICAgICAgICAgICAgICAgICAgIHNjYWxlWSA6IHRoaXMub2JqZWN0c1tvYmouaWRdLnNjYWxlWSxcbiAgICAgICAgICAgICAgICAgICAgcm90YXRpb24gOiB0aGlzLm9iamVjdHNbb2JqLmlkXS5yb3RhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgYWxwaGEgOiB0aGlzLm9iamVjdHNbb2JqLmlkXS5hbHBoYSxcbiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZSA6IHRoaXMub2JqZWN0c1tvYmouaWRdLnZpc2libGVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHBhcmVudF9pZCkge1xuICAgICAgICAgICAgICAgIHRoaXMub2JqZWN0c1twYXJlbnRfaWRdLmFkZENoaWxkKHRoaXMub2JqZWN0c1tvYmouaWRdKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc3RhZ2UuYWRkQ2hpbGQodGhpcy5vYmplY3RzW29iai5pZF0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyDoh6rlrprkuYnlsZ7mgKdcbiAgICAgICAgICAgIGlmIChjdXN0b20pIHtcbiAgICAgICAgICAgICAgICBjdXN0b20odGhpcy5vYmplY3RzW29iai5pZF0sIG9iaik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvYmouY2hpbGRyZW4pIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9yZW5kZXIob2JqLmNoaWxkcmVuLCBvYmouaWQsIGN1c3RvbSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmlzTG9nKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5ncm91cEVuZCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuX3N0YWdlLnVwZGF0ZSgpO1xuXG4gICAgfVxuXG4gICAgX2NyZWF0ZUFuaW1hdGUoZGlzcGxheU9iamVjdCwge1xuICAgICAgICB4ID0gbnVsbCxcbiAgICAgICAgeSA9IG51bGwsXG4gICAgICAgIHNjYWxlWCA9IG51bGwsXG4gICAgICAgIHNjYWxlWSA9IG51bGwsXG4gICAgICAgIHNrZXdYID0gbnVsbCxcbiAgICAgICAgc2tld1kgPSBudWxsLFxuICAgICAgICByb3RhdGlvbiA9IG51bGwsXG4gICAgICAgIGFscGhhID0gMSxcbiAgICAgICAgdG9wID0gMCxcbiAgICAgICAgZHVyYXRpb24gPSAwLFxuICAgICAgICBzcHJpdGUgPSBbXSxcbiAgICAgICAgc3RhcnRCeUlkID0gbnVsbCxcbiAgICAgICAgZW5kQnlJZCA9IG51bGwsXG4gICAgICAgIGFmdGVyQnlJZCA9IG51bGwsXG4gICAgICAgIG11c2ljQnlJZCA9IG51bGwsXG4gICAgfSA9IHt9KSB7XG4gICAgICAgIGxldCBtYXBQb3MgPSAodGhpcy5pc1ZlcnRpY2FsPyBkaXNwbGF5T2JqZWN0LnkgOiBkaXNwbGF5T2JqZWN0LngpICsgX2luaXRBbmltYXRlUG9zaXRpb24odGhpcyksICAgICAgICAvLyDlr7nosaHkvY3nva5cbiAgICAgICAgICAgIHN0YXJ0WCA9IGRpc3BsYXlPYmplY3QueCwgICAgICAgICAgICAgICAgICAgIC8vIOWKqOeUuyBYIOW8gOWni1xuICAgICAgICAgICAgc3RhcnRZID0gZGlzcGxheU9iamVjdC55LCAgICAgICAgICAgICAgICAgICAgLy8g5Yqo55S7IFkg5byA5aeLXG4gICAgICAgICAgICBlbmRYID0geCwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDliqjnlLsgWCDnu5PmnZ9cbiAgICAgICAgICAgIGVuZFkgPSB5LCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOWKqOeUuyBZIOe7k+adn1xuICAgICAgICAgICAgaW5pdEFscGhhID0gZGlzcGxheU9iamVjdC5hbHBoYSxcbiAgICAgICAgICAgIGluaXRTY2FsZVggPSBkaXNwbGF5T2JqZWN0LnNjYWxlWCxcbiAgICAgICAgICAgIGluaXRTY2FsZVkgPSBkaXNwbGF5T2JqZWN0LnNjYWxlWSxcbiAgICAgICAgICAgIGluaXRTa2V3WCA9IGRpc3BsYXlPYmplY3Quc2tld1gsXG4gICAgICAgICAgICBpbml0U2tld1kgPSBkaXNwbGF5T2JqZWN0LnNrZXdZLFxuICAgICAgICAgICAgaW5pdFJvdGF0aW9uID0gZGlzcGxheU9iamVjdC5yb3RhdGlvbixcbiAgICAgICAgICAgIGlzTXVzaWMgPSBmYWxzZSxcbiAgICAgICAgICAgIGlzUGxheSA9IGZhbHNlO1xuXG4gICAgICAgIGxldCBhbmltYXRlUGxheVN0YXJ0ID0gMDsgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOWvueixoeW8gOWni+aJp+ihjOWKqOeUu+S9jee9rlxuICAgICAgICBsZXQgYW5pbWF0ZVBsYXlFbmQgPSAwOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDlr7nosaHnu5PmnZ/miafooYzliqjnlLvkvY3nva5cblxuICAgICAgICBpZiAoc3RhcnRCeUlkKSB7XG4gICAgICAgICAgICBhbmltYXRlUGxheVN0YXJ0ID0gdGhpcy5vYmplY3RzW3N0YXJ0QnlJZF0uYW5pbWF0aW9uLmFuaW1hdGVQbGF5U3RhcnQ7XG4gICAgICAgIH0gZWxzZSBpZiAoYWZ0ZXJCeUlkKSB7XG4gICAgICAgICAgICBhbmltYXRlUGxheVN0YXJ0ID0gdGhpcy5vYmplY3RzW2FmdGVyQnlJZF0uYW5pbWF0aW9uLmFuaW1hdGVQbGF5RW5kO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKG1hcFBvcyAtIHRvcCA+PSB0aGlzLm1hcFBsYXkpIHtcbiAgICAgICAgICAgICAgICBhbmltYXRlUGxheVN0YXJ0ID0gbWFwUG9zIC0gdG9wIC0gdGhpcy5tYXBQbGF5O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBhbmltYXRlUGxheVN0YXJ0ID0gdGhpcy5tYXBTdGFydDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChlbmRCeUlkICYmIGFuaW1hdGVQbGF5U3RhcnQgPCB0aGlzLm9iamVjdHNbZW5kQnlJZF0uYW5pbWF0aW9uLmFuaW1hdGVQbGF5RW5kKSB7XG4gICAgICAgICAgICBhbmltYXRlUGxheUVuZCA9IHRoaXMub2JqZWN0c1tlbmRCeUlkXS5hbmltYXRpb24uYW5pbWF0ZVBsYXlFbmQ7XG4gICAgICAgICAgICBkdXJhdGlvbiA9IGFuaW1hdGVQbGF5RW5kIC0gYW5pbWF0ZVBsYXlTdGFydDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGFuaW1hdGVQbGF5RW5kID0gYW5pbWF0ZVBsYXlTdGFydCArIGR1cmF0aW9uO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gX2luaXRBbmltYXRlUG9zaXRpb24oY3R4KSB7XG4gICAgICAgICAgICBsZXQgc3VtID0gMDtcblxuICAgICAgICAgICAgX2NvdW50U3VtWShkaXNwbGF5T2JqZWN0KTtcblxuICAgICAgICAgICAgcmV0dXJuIHN1bTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gX2NvdW50U3VtWShkaXNwbGF5T2JqZWN0KSB7XG4gICAgICAgICAgICAgICAgbGV0IHBhcmVudCA9IGRpc3BsYXlPYmplY3QucGFyZW50O1xuXG4gICAgICAgICAgICAgICAgaWYgKHBhcmVudCAmJiBwYXJlbnQucGFyZW50ICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHN1bSArPSBjdHguaXNWZXJ0aWNhbD8gcGFyZW50LnkgOiBwYXJlbnQueDtcbiAgICAgICAgICAgICAgICAgICAgX2NvdW50U3VtWShwYXJlbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIF9hbmltYXRlKHJhdGUpIHtcblxuICAgICAgICAgICAgbGV0IHByb2dyZXNzID0gcmF0ZS9kdXJhdGlvbjtcblxuICAgICAgICAgICAgaWYgKHNwcml0ZS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgbGV0IGxlbmd0aCA9IHNwcml0ZS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgbGV0IGR1cmF0aW9uU2VnbWVudCA9IGR1cmF0aW9uL2xlbmd0aDtcbiAgICAgICAgICAgICAgICBsZXQgY3VycmVudEluZGV4ID0gTWF0aC5taW4ocmF0ZS9kdXJhdGlvblNlZ21lbnQgfCAwLCBsZW5ndGggLSAxKTtcbiAgICAgICAgICAgICAgICBkaXNwbGF5T2JqZWN0LmltYWdlID0gc3ByaXRlW2N1cnJlbnRJbmRleF07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKGVuZFggfHwgZW5kWCA9PT0gMCkgZGlzcGxheU9iamVjdC54ID0gcHJvZ3Jlc3MgKiAoZW5kWCAtIHN0YXJ0WCkgKyBzdGFydFg7XG4gICAgICAgICAgICBpZihlbmRZIHx8IGVuZFkgPT09IDApIGRpc3BsYXlPYmplY3QueSA9IHByb2dyZXNzICogIChlbmRZIC0gc3RhcnRZKSArIHN0YXJ0WTtcbiAgICAgICAgICAgIGlmKGFscGhhIHx8IGFscGhhID09PSAwKSBkaXNwbGF5T2JqZWN0LmFscGhhID0gcHJvZ3Jlc3MgKiAoYWxwaGEgLSBpbml0QWxwaGEpICsgaW5pdEFscGhhO1xuICAgICAgICAgICAgaWYoc2NhbGVYIHx8IHNjYWxlWCA9PT0gMCkgZGlzcGxheU9iamVjdC5zY2FsZVggPSBwcm9ncmVzcyAqIChzY2FsZVggLSBpbml0U2NhbGVYKSArIGluaXRTY2FsZVg7XG4gICAgICAgICAgICBpZihzY2FsZVkgfHwgc2NhbGVZID09PSAwKSBkaXNwbGF5T2JqZWN0LnNjYWxlWSA9IHByb2dyZXNzICogKHNjYWxlWSAtIGluaXRTY2FsZVkpICsgaW5pdFNjYWxlWTtcbiAgICAgICAgICAgIGlmKHNrZXdYIHx8IHNrZXdYID09PSAwKSBkaXNwbGF5T2JqZWN0LnNrZXdYID0gcHJvZ3Jlc3MgKiAoc2tld1ggLSBpbml0U2tld1gpICsgaW5pdFNrZXdYO1xuICAgICAgICAgICAgaWYoc2tld1kgfHwgc2tld1kgPT09IDApIGRpc3BsYXlPYmplY3Quc2tld1kgPSBwcm9ncmVzcyAqIChza2V3WSAtIGluaXRTa2V3WSkgKyBpbml0U2tld1k7XG4gICAgICAgICAgICBpZihyb3RhdGlvbiB8fCByb3RhdGlvbiA9PT0gMCkgZGlzcGxheU9iamVjdC5yb3RhdGlvbiA9IHByb2dyZXNzICogKHJvdGF0aW9uIC0gaW5pdFJvdGF0aW9uKSArIGluaXRSb3RhdGlvbjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBhbmltYXRlUGxheVN0YXJ0LFxuICAgICAgICAgICAgYW5pbWF0ZVBsYXlFbmQsXG4gICAgICAgICAgICB1cGRhdGUocmF0ZSkge1xuICAgICAgICAgICAgICAgIGxldCBwcm9ncmVzcyA9IHJhdGUvZHVyYXRpb247XG5cbiAgICAgICAgICAgICAgICBpZiAoKHByb2dyZXNzID09PSAwIHx8IHByb2dyZXNzID09PSAxKSAmJiBpc1BsYXkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAocHJvZ3Jlc3MgPj0gMSkge1xuICAgICAgICAgICAgICAgICAgICBwcm9ncmVzcyA9IDE7XG4gICAgICAgICAgICAgICAgICAgIGlzUGxheSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocHJvZ3Jlc3MgPD0gMCkge1xuICAgICAgICAgICAgICAgICAgICBwcm9ncmVzcyA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGlzUGxheSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlzUGxheSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKG11c2ljQnlJZCkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgbXVzaWMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChtdXNpY0J5SWQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobXVzaWMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc011c2ljID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzTXVzaWMgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG11c2ljLmN1cnJlbnRUaW1lID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdXNpYy5wbGF5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzTXVzaWMgPT09IHRydWUgJiYgcHJvZ3Jlc3MgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdXNpYy5wYXVzZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzTXVzaWMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG11c2ljLmxvb3AgJiYgaXNNdXNpYyA9PT0gdHJ1ZSAmJiBwcm9ncmVzcyA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG11c2ljLnBhdXNlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNNdXNpYyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgX2FuaW1hdGUocmF0ZSlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXQocmF0ZSkge1xuICAgICAgICAgICAgICAgIGlmIChpc1BsYXkpIGlzUGxheSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGlmIChpc011c2ljKSBpc011c2ljID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICBfYW5pbWF0ZShyYXRlKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgX3N0YXRzICgpIHtcbiAgICAgICAgdGhpcy5zdGF0cyA9IG5ldyBTdGF0cygpO1xuICAgICAgICB0aGlzLnN0YXRzLnNob3dQYW5lbCgwKTsgLy8gMDogZnBzLCAxOiBtcywgMjogbWIsIDMrOiBjdXN0b21cbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLnN0YXRzLmRvbSk7XG4gICAgfVxufVxuXG4iXX0=
