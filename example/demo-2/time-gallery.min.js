'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 *  @Width: 画布宽
 *  @Height: 画布高
 *  @isState: 是否启动 Stage.js 测试FPS, 依赖 stage.js
 *  @isLog: 是否打印数据结构
 *  @direction: 可设置水平(horizontal)或垂直(vertical)
 *  @resourcesPath: 图片资源加载的默认路劲
 *  @resources: 图片资源
 *  @sprites: 自定义雪碧图数据数组，方便创建数据的时候可随时调用雪碧图
 *  @data: 创建画布数据
 *  @onInit: 初始化后的回调
 *  @onEnd: 结束后的回调
 *  @onTickStart: 每一帧的开始前回调
 *  @onTickEnd: 每一帧的结束后回调
 *  @mapStart: 定义画布始点位置
 *  @mapActive: 定义画布当前的播放的位置（可方便测试）
 *  @mapEnd: 画布默认结束位置，默认是 animatePlayEnd 最大值或地图的高度
 *  @mapPlay: 定义画布播放动画的位置（默认元素再屏幕底部的位置开始播放动画）
 *  @touchSpeed: 定义用户滑动速度，越大，滑动的速度越快
 *  @autoPlay: 是否自动播放
 *  @autoSpeed: 自动播放速度
 */

var TimeGallery = function () {
    function TimeGallery(options) {
        _classCallCheck(this, TimeGallery);

        if (options.id === '') {
            console.error('ID not exist');
        }

        this.width = options.width || window.innerWidth;
        this.height = options.height || window.innerHeight;
        this._stage = new createjs.Stage(document.getElementById(options.id));
        this._stage.canvas.width = this.width;
        this._stage.canvas.height = this.height;
        this._loadQueue = null;
        this._isLoading = false;
        this._isEnd = false;
        this._dirGroup = {
            horizontal: 'horizontal',
            vertical: 'vertical'
        };

        this.isVertical = (options.direction || this._dirGroup.vertical) === this._dirGroup.vertical;
        this.isMoving = false;
        this.isState = options.isState || false;
        this.isLog = options.isLog || false;

        this.autoPlay = options.autoPlay || false;
        this.autoSpeed = options.autoSpeed || 1;

        this.resourcesPath = options.resourcesPath || '';
        this.resources = options.resources || [];
        this.sprites = options.sprites || {};
        this.data = options.data || [];

        this.onInit = options.onInit || null;
        this.onEnd = options.onEnd || null;
        this.onTickStart = options.onTickStart || null;
        this.onTickEnd = options.onTickEnd || null;

        this.mapStart = options.mapStart || 0;
        this.mapActive = options.mapActive || 0;
        this.mapEnd = options.mapEnd || 0;
        this.mapPlay = options.mapPlay || (this.isVertical ? this.height : this.width);

        this.objects = {};
        this.animatorsGroup = []; // 执行动画的数组
        this.touchData = {
            touchstart: 0, // TouchStart 初始 Y 位置
            touchmove: 0, // TouchMove  初始 Y 距离
            friction: 0.9, // 摩擦值
            speed: options.touchSpeed || 1, // Touch 滑动速度
            isInertance: false // 惯性
        };

        this.init();
    }

    _createClass(TimeGallery, [{
        key: 'init',
        value: function init() {
            var _this = this;

            this._preload(this.resources, {
                path: this.resourcesPath,
                onComplete: function onComplete() {

                    if (typeof _this.sprites === 'function') _this.sprites = _this.sprites(_this);
                    if (typeof _this.data === 'function') _this.data = _this.data(_this);

                    var data = [{
                        id: 'map',
                        children: _this.data
                    }];

                    // 渲染图像数据
                    _this._render(data, null, function (displayObject, obj) {
                        if (displayObject) {
                            if (obj.animation) {
                                displayObject.animation = _this._createAnimate(displayObject, obj.animation);
                                _this.animatorsGroup.push({ displayObject: displayObject });
                            }
                        }
                    });

                    _this.map = _this.objects['map'];

                    var mapActive = _this.mapActive ? -_this.mapActive : -_this.mapStart;

                    if (_this.isVertical) {
                        _this.map.y = mapActive;
                    } else {
                        _this.map.x = mapActive;
                    }

                    if (!_this.mapEnd) {
                        var mapLong = void 0;
                        if (_this.isVertical) {
                            mapLong = _this.map.getBounds().height + _this.map.getBounds().y - _this.height;
                        } else {
                            mapLong = _this.map.getBounds().width + _this.map.getBounds().x - _this.width;
                        }
                        var maxAnimatePlayEnd = Math.max.apply(Math, _this.animatorsGroup.map(function (item) {
                            return item.displayObject.animation.animatePlayEnd;
                        }));
                        _this.mapEnd = Math.max(mapLong, maxAnimatePlayEnd);
                    }

                    // 初始化滑动事件
                    _this._initTouchEvent();

                    if (_this.onInit) _this.onInit();

                    // 是否打印 FPS 状态，依赖 state.js
                    if (_this.isState) _this._stats();

                    _this._stage.update();
                }
            });

            createjs.Ticker.timingMode = createjs.Ticker.RAF;
        }
    }, {
        key: 'play',
        value: function play() {
            createjs.Ticker.addEventListener('tick', this._onTick.bind(this));
        }
    }, {
        key: 'replay',
        value: function replay() {
            this._isEnd = false;

            this.touchData.touchstart = 0;
            this.touchData.touchmove = 0;
            this.touchData.isInertance = false;

            if (this.isVertical) {
                this.map.y = -this.mapStart;
            } else {
                this.map.x = -this.mapStart;
            }

            this.animatorsGroup.forEach(function (item) {
                item.displayObject.animation.set(0);
            });

            this._stage.update();

            this.play();
        }
    }, {
        key: 'stop',
        value: function stop() {
            createjs.Ticker.removeAllEventListeners();
        }
    }, {
        key: 'getImage',
        value: function getImage(id) {
            return this._loadQueue[id];
        }
    }, {
        key: '_onTick',
        value: function _onTick() {
            if (!this._isLoading && this.map) {

                if (this.autoPlay || this.isMoving) {

                    if (this.onTickStart) this.onTickStart(this);

                    var pos = void 0;

                    if (this.autoPlay) {
                        if (this.isVertical) {
                            this.map.y -= this.autoSpeed;
                            pos = -this.map.y;
                        } else {
                            this.map.x -= this.autoSpeed;
                            pos = -this.map.x;
                        }

                        if (this.touchData.touchmove !== 0) {
                            this.touchData.touchstart = 0;
                            this.touchData.touchmove = 0;
                            this.touchData.isInertance = false;
                            this.isMoving = false;
                        }
                    } else if (this.isMoving) {

                        // 如果是惯性
                        if (this.touchData.isInertance) {
                            // 惯性减速
                            this.touchData.touchmove *= this.touchData.friction;

                            if (Math.abs(this.touchData.touchmove) <= 1) {
                                this.touchData.touchstart = 0;
                                this.touchData.touchmove = 0;
                                this.touchData.isInertance = false;
                                this.isMoving = false;
                            }
                        }

                        // 根据滑动的位置记录动画执行
                        if (this.isVertical) {
                            this.map.y += this.touchData.touchmove * this.touchData.speed;
                            pos = -this.map.y;
                        } else {
                            this.map.x += this.touchData.touchmove * this.touchData.speed;
                            pos = -this.map.x;
                        }
                    }

                    if (pos < this.mapStart) {
                        if (this.isVertical) {
                            this.map.y = -this.mapStart;
                        } else {
                            this.map.x = -this.mapStart;
                        }
                    }

                    if (pos > this.mapEnd) {

                        if (this._isEnd) return;

                        this._isEnd = true;

                        if (this.isVertical) {
                            this.map.y = -this.mapEnd;
                        } else {
                            this.map.x = -this.mapEnd;
                        }

                        if (this.onEnd) {
                            this.onEnd();
                            return;
                        }
                    }

                    this.mapActive = this.isVertical ? -this.map.y : -this.map.x;

                    this._updateAnimators();
                }
            }

            if (this.isState) {
                this.stats.update();
            }
        }
    }, {
        key: '_updateAnimators',
        value: function _updateAnimators() {
            var pos = this.isVertical ? -this.map.y : -this.map.x;

            this.animatorsGroup.map(function (obj) {
                var displayObject = obj.displayObject;
                var animatePlayStart = displayObject.animation.animatePlayStart;
                var animatePlayEnd = displayObject.animation.animatePlayEnd;

                if (pos >= animatePlayStart && pos < animatePlayEnd) {
                    var duration = Math.abs(pos - animatePlayStart);
                    displayObject.animation.update(duration);
                } else if (pos < animatePlayStart) {
                    displayObject.animation.update(0);
                } else if (pos > animatePlayEnd) {
                    displayObject.animation.update(animatePlayEnd - animatePlayStart);
                }
            });

            if (this.onTickEnd) this.onTickEnd(this);

            this._stage.update();
        }

        // 初始化手势

    }, {
        key: '_initTouchEvent',
        value: function _initTouchEvent() {
            var _this2 = this;

            this._stage.canvas.addEventListener('touchstart', function (e) {

                if (_this2.autoPlay) return;

                if (_this2.isVertical) {
                    _this2.touchData.touchstart = e.touches[0].clientY;
                } else {
                    _this2.touchData.touchstart = e.touches[0].clientX;
                }

                _this2.touchData.isInertance = false;
                _this2.isMoving = false;
            });

            this._stage.canvas.addEventListener('touchmove', function (e) {
                if (_this2.isVertical) {
                    _this2.touchData.touchmove = e.touches[0].clientY - _this2.touchData.touchstart;
                    _this2.touchData.touchstart = e.touches[0].clientY;
                } else {
                    _this2.touchData.touchmove = e.touches[0].clientX - _this2.touchData.touchstart;
                    _this2.touchData.touchstart = e.touches[0].clientX;
                }
                _this2.isMoving = true;
            });

            this._stage.canvas.addEventListener('touchend', function () {
                if (_this2.autoPlay) return;
                _this2.touchData.isInertance = true;
            });
        }
    }, {
        key: '_preload',
        value: function _preload() {
            var _this3 = this;

            var manifest = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];

            var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
                _ref$onComplete = _ref.onComplete,
                onComplete = _ref$onComplete === undefined ? function () {} : _ref$onComplete,
                _ref$onProgress = _ref.onProgress,
                onProgress = _ref$onProgress === undefined ? function () {} : _ref$onProgress,
                _ref$path = _ref.path,
                path = _ref$path === undefined ? '' : _ref$path;

            this._isLoading = true;

            var fileList = null;

            if (Array.isArray(manifest)) {
                if (manifest.length === 0) return;
                fileList = manifest;
            } else if (typeof manifest === 'string') {
                fileList = [{
                    src: manifest,
                    id: manifest
                }];
            } else if ((typeof manifest === 'undefined' ? 'undefined' : _typeof(manifest)) === 'object') {
                if (!manifest.id) {
                    manifest.id = manifest.src;
                }
                fileList = [manifest];
            } else {
                return false;
            }

            var loadedNumber = 0;
            var preloadNumber = fileList.length;
            var images = {};

            var _loop = function _loop(i) {
                var image = new Image();
                var file = fileList[i];
                var fileType = typeof file === 'undefined' ? 'undefined' : _typeof(file);
                var src = '';

                if (fileType === 'object') {
                    src = file.src;
                } else if (fileType === 'string') {
                    src = file;
                }

                image.src = path + src;
                image.onload = function () {
                    if (file.id) {
                        images[file.id] = image;
                    } else {
                        images[src] = image;
                    }
                    loadedNumber++;

                    var progress = Math.floor(loadedNumber / preloadNumber * 100);
                    onProgress(progress);

                    if (progress >= 100) {
                        _this3._isLoading = false;
                        _this3._loadQueue = images;
                        onComplete();
                    }
                };
            };

            for (var i = 0; i < preloadNumber; i++) {
                _loop(i);
            }

            // this._loadQueue = new createjs.LoadQueue(true, path);
            //
            // if (progress) this._loadQueue.on('progress', e => onProgress(e));
            //
            // this._loadQueue.on('complete', e => {
            //     this._isLoading = false;
            //     if (onComplete) onComplete(e);
            // });
            //
            // this._loadQueue.loadManifest(loadManifest);
        }
    }, {
        key: '_addObj',
        value: function _addObj() {
            var obj = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};


            var displayObject = null;

            switch (obj.type) {
                case 'shape':
                    displayObject = new createjs.Shape();
                    break;
                case 'bitmap':
                    if (obj.image) {
                        displayObject = new createjs.Bitmap(obj.image);
                    }
                    break;
                case 'text':
                    displayObject = new createjs.Text();
                    break;
                case 'sprite':
                    if (obj.sheet) {
                        var spriteSheet = new createjs.SpriteSheet(obj.sheet);
                        displayObject = new createjs.Sprite(spriteSheet);
                    }
                    break;
                default:
                    displayObject = new createjs.Container();
                    break;
            }

            if (obj.type) {
                displayObject.type = obj.type;
            } else {
                displayObject.type = 'container';
            }

            if (obj.id) displayObject.name = obj.id;

            if (obj.parent_id) displayObject.parentId = obj.parent_id;

            if (obj.prop) {
                var _iteratorNormalCompletion = true;
                var _didIteratorError = false;
                var _iteratorError = undefined;

                try {
                    for (var _iterator = Object.keys(obj.prop)[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                        var propKey = _step.value;

                        // 判断属性类型
                        if (displayObject[propKey] instanceof Object) {
                            var _iteratorNormalCompletion2 = true;
                            var _didIteratorError2 = false;
                            var _iteratorError2 = undefined;

                            try {
                                for (var _iterator2 = Object.keys(obj.prop[propKey])[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
                                    var key = _step2.value;

                                    if (typeof displayObject[propKey][key] === 'function') {
                                        var _displayObject$propKe;

                                        (_displayObject$propKe = displayObject[propKey])[key].apply(_displayObject$propKe, _toConsumableArray(obj.prop[propKey][key]));
                                    } else {
                                        displayObject[propKey][key] = obj.prop[propKey][key];
                                    }
                                }
                            } catch (err) {
                                _didIteratorError2 = true;
                                _iteratorError2 = err;
                            } finally {
                                try {
                                    if (!_iteratorNormalCompletion2 && _iterator2.return) {
                                        _iterator2.return();
                                    }
                                } finally {
                                    if (_didIteratorError2) {
                                        throw _iteratorError2;
                                    }
                                }
                            }
                        } else if (typeof displayObject[propKey] === 'function') {
                            var _displayObject;

                            (_displayObject = displayObject)[propKey].apply(_displayObject, _toConsumableArray(obj.prop[propKey]));
                        } else {
                            displayObject[propKey] = obj.prop[propKey];
                        }
                    }
                } catch (err) {
                    _didIteratorError = true;
                    _iteratorError = err;
                } finally {
                    try {
                        if (!_iteratorNormalCompletion && _iterator.return) {
                            _iterator.return();
                        }
                    } finally {
                        if (_didIteratorError) {
                            throw _iteratorError;
                        }
                    }
                }

                if (obj.type === 'text' && obj.prop.align) {
                    switch (obj.prop.align) {
                        case 'center':
                            displayObject.x = (this.width - displayObject.getBounds().width) / 2;
                            break;
                        case 'right':
                            displayObject.x = this.width - displayObject.getBounds().width;
                            break;
                        default:
                            displayObject.x = 0;
                    }
                }
            }

            if (obj.method) {
                var _iteratorNormalCompletion3 = true;
                var _didIteratorError3 = false;
                var _iteratorError3 = undefined;

                try {
                    for (var _iterator3 = Object.keys(obj.method)[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
                        var _displayObject2;

                        var _key = _step3.value;

                        (_displayObject2 = displayObject)[_key].apply(_displayObject2, _toConsumableArray(obj.method[_key]));
                    }
                } catch (err) {
                    _didIteratorError3 = true;
                    _iteratorError3 = err;
                } finally {
                    try {
                        if (!_iteratorNormalCompletion3 && _iterator3.return) {
                            _iterator3.return();
                        }
                    } finally {
                        if (_didIteratorError3) {
                            throw _iteratorError3;
                        }
                    }
                }
            }

            if (obj.event) {
                if (obj.event.handle) {
                    var type = obj.event.type || 'click';
                    displayObject.addEventListener(type, obj.event.handle);
                }
            }

            if (displayObject.getBounds()) {
                var bounds = displayObject.getBounds();
                displayObject.width = bounds.width;
                displayObject.height = bounds.height;
            }

            return displayObject;
        }
    }, {
        key: '_render',
        value: function _render() {
            var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];

            var _this4 = this;

            var parent_id = arguments[1];
            var custom = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function () {};


            if (data instanceof Object) {
                data = Array.from(data);
            }

            data.map(function (obj) {

                obj.parent_id = parent_id;

                _this4.objects[obj.id] = _this4._addObj(obj);

                if (_this4.isLog) {
                    console.group(obj.id + ':');
                    console.table({
                        x: _this4.objects[obj.id].x,
                        y: _this4.objects[obj.id].y,
                        regX: _this4.objects[obj.id].regX,
                        regY: _this4.objects[obj.id].regY,
                        scaleX: _this4.objects[obj.id].scaleX,
                        scaleY: _this4.objects[obj.id].scaleY,
                        rotation: _this4.objects[obj.id].rotation,
                        alpha: _this4.objects[obj.id].alpha,
                        visible: _this4.objects[obj.id].visible
                    });
                }

                if (parent_id) {
                    _this4.objects[parent_id].addChild(_this4.objects[obj.id]);
                } else {
                    _this4._stage.addChild(_this4.objects[obj.id]);
                }

                // 自定义属性
                if (custom) {
                    custom(_this4.objects[obj.id], obj);
                }

                if (obj.children) {
                    _this4._render(obj.children, obj.id, custom);
                }

                if (_this4.isLog) {
                    console.groupEnd();
                }
            });

            this._stage.update();
        }
    }, {
        key: '_createAnimate',
        value: function _createAnimate(displayObject) {
            var _ref2 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
                _ref2$x = _ref2.x,
                x = _ref2$x === undefined ? null : _ref2$x,
                _ref2$y = _ref2.y,
                y = _ref2$y === undefined ? null : _ref2$y,
                _ref2$scaleX = _ref2.scaleX,
                scaleX = _ref2$scaleX === undefined ? null : _ref2$scaleX,
                _ref2$scaleY = _ref2.scaleY,
                scaleY = _ref2$scaleY === undefined ? null : _ref2$scaleY,
                _ref2$skewX = _ref2.skewX,
                skewX = _ref2$skewX === undefined ? null : _ref2$skewX,
                _ref2$skewY = _ref2.skewY,
                skewY = _ref2$skewY === undefined ? null : _ref2$skewY,
                _ref2$rotation = _ref2.rotation,
                rotation = _ref2$rotation === undefined ? null : _ref2$rotation,
                _ref2$alpha = _ref2.alpha,
                alpha = _ref2$alpha === undefined ? 1 : _ref2$alpha,
                _ref2$top = _ref2.top,
                top = _ref2$top === undefined ? 0 : _ref2$top,
                _ref2$duration = _ref2.duration,
                duration = _ref2$duration === undefined ? 0 : _ref2$duration,
                _ref2$sprite = _ref2.sprite,
                sprite = _ref2$sprite === undefined ? [] : _ref2$sprite,
                _ref2$startById = _ref2.startById,
                startById = _ref2$startById === undefined ? null : _ref2$startById,
                _ref2$endById = _ref2.endById,
                endById = _ref2$endById === undefined ? null : _ref2$endById,
                _ref2$afterById = _ref2.afterById,
                afterById = _ref2$afterById === undefined ? null : _ref2$afterById,
                _ref2$musicById = _ref2.musicById,
                musicById = _ref2$musicById === undefined ? null : _ref2$musicById;

            var mapPos = (this.isVertical ? displayObject.y : displayObject.x) + _initAnimatePosition(this),
                // 对象位置
            startX = displayObject.x,
                // 动画 X 开始
            startY = displayObject.y,
                // 动画 Y 开始
            endX = x,
                // 动画 X 结束
            endY = y,
                // 动画 Y 结束
            initAlpha = displayObject.alpha,
                initScaleX = displayObject.scaleX,
                initScaleY = displayObject.scaleY,
                initSkewX = displayObject.skewX,
                initSkewY = displayObject.skewY,
                initRotation = displayObject.rotation,
                isMusic = false,
                isPlay = false;

            var animatePlayStart = 0; // 对象开始执行动画位置
            var animatePlayEnd = 0; // 对象结束执行动画位置

            if (startById) {
                animatePlayStart = this.objects[startById].animation.animatePlayStart;
            } else if (afterById) {
                animatePlayStart = this.objects[afterById].animation.animatePlayEnd;
            } else {
                if (mapPos - top >= this.mapPlay) {
                    animatePlayStart = mapPos - top - this.mapPlay;
                } else {
                    animatePlayStart = this.mapStart;
                }
            }

            if (endById && animatePlayStart < this.objects[endById].animation.animatePlayEnd) {
                animatePlayEnd = this.objects[endById].animation.animatePlayEnd;
                duration = animatePlayEnd - animatePlayStart;
            } else {
                animatePlayEnd = animatePlayStart + duration;
            }

            function _initAnimatePosition(ctx) {
                var sum = 0;

                _countSumY(displayObject);

                return sum;

                function _countSumY(displayObject) {
                    var parent = displayObject.parent;

                    if (parent && parent.parent !== null) {
                        sum += ctx.isVertical ? parent.y : parent.x;
                        _countSumY(parent);
                    }
                }
            }

            function _animate(rate) {

                var progress = rate / duration;

                if (sprite.length > 1) {
                    var length = sprite.length;
                    var durationSegment = duration / length;
                    var currentIndex = Math.min(rate / durationSegment | 0, length - 1);
                    displayObject.image = sprite[currentIndex];
                }

                if (endX || endX === 0) displayObject.x = progress * (endX - startX) + startX;
                if (endY || endY === 0) displayObject.y = progress * (endY - startY) + startY;
                if (alpha || alpha === 0) displayObject.alpha = progress * (alpha - initAlpha) + initAlpha;
                if (scaleX || scaleX === 0) displayObject.scaleX = progress * (scaleX - initScaleX) + initScaleX;
                if (scaleY || scaleY === 0) displayObject.scaleY = progress * (scaleY - initScaleY) + initScaleY;
                if (skewX || skewX === 0) displayObject.skewX = progress * (skewX - initSkewX) + initSkewX;
                if (skewY || skewY === 0) displayObject.skewY = progress * (skewY - initSkewY) + initSkewY;
                if (rotation || rotation === 0) displayObject.rotation = progress * (rotation - initRotation) + initRotation;
            }

            return {
                animatePlayStart: animatePlayStart,
                animatePlayEnd: animatePlayEnd,
                update: function update(rate) {
                    var progress = rate / duration;

                    if ((progress === 0 || progress === 1) && isPlay === false) {
                        return;
                    }

                    if (progress >= 1) {
                        progress = 1;
                        isPlay = false;
                    } else if (progress <= 0) {
                        progress = 0;
                        isPlay = false;
                    } else {
                        isPlay = true;
                    }

                    if (musicById) {
                        var music = document.getElementById(musicById);
                        if (music) {
                            if (isMusic === false) {
                                isMusic = true;
                                music.currentTime = 0;
                                music.play();
                            } else if (isMusic === true && progress === 0) {
                                music.pause();
                                isMusic = false;
                            }

                            if (music.loop && isMusic === true && progress === 1) {
                                music.pause();
                                isMusic = false;
                            }
                        }
                    }

                    _animate(rate);
                },
                set: function set(rate) {
                    if (isPlay) isPlay = false;
                    if (isMusic) isMusic = false;

                    _animate(rate);
                }
            };
        }
    }, {
        key: '_stats',
        value: function _stats() {
            this.stats = new Stats();
            this.stats.showPanel(0); // 0: fps, 1: ms, 2: mb, 3+: custom
            document.body.appendChild(this.stats.dom);
        }
    }]);

    return TimeGallery;
}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRpbWUtZ2FsbGVyeS5qcyJdLCJuYW1lcyI6WyJUaW1lR2FsbGVyeSIsIm9wdGlvbnMiLCJpZCIsImNvbnNvbGUiLCJlcnJvciIsIndpZHRoIiwid2luZG93IiwiaW5uZXJXaWR0aCIsImhlaWdodCIsImlubmVySGVpZ2h0IiwiX3N0YWdlIiwiY3JlYXRlanMiLCJTdGFnZSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJjYW52YXMiLCJfbG9hZFF1ZXVlIiwiX2lzTG9hZGluZyIsIl9pc0VuZCIsIl9kaXJHcm91cCIsImhvcml6b250YWwiLCJ2ZXJ0aWNhbCIsImlzVmVydGljYWwiLCJkaXJlY3Rpb24iLCJpc01vdmluZyIsImlzU3RhdGUiLCJpc0xvZyIsImF1dG9QbGF5IiwiYXV0b1NwZWVkIiwicmVzb3VyY2VzUGF0aCIsInJlc291cmNlcyIsInNwcml0ZXMiLCJkYXRhIiwib25Jbml0Iiwib25FbmQiLCJvblRpY2tTdGFydCIsIm9uVGlja0VuZCIsIm1hcFN0YXJ0IiwibWFwQWN0aXZlIiwibWFwRW5kIiwibWFwUGxheSIsIm9iamVjdHMiLCJhbmltYXRvcnNHcm91cCIsInRvdWNoRGF0YSIsInRvdWNoc3RhcnQiLCJ0b3VjaG1vdmUiLCJmcmljdGlvbiIsInNwZWVkIiwidG91Y2hTcGVlZCIsImlzSW5lcnRhbmNlIiwiaW5pdCIsIl9wcmVsb2FkIiwicGF0aCIsIm9uQ29tcGxldGUiLCJjaGlsZHJlbiIsIl9yZW5kZXIiLCJkaXNwbGF5T2JqZWN0Iiwib2JqIiwiYW5pbWF0aW9uIiwiX2NyZWF0ZUFuaW1hdGUiLCJwdXNoIiwibWFwIiwieSIsIngiLCJtYXBMb25nIiwiZ2V0Qm91bmRzIiwibWF4QW5pbWF0ZVBsYXlFbmQiLCJNYXRoIiwibWF4IiwiYXBwbHkiLCJpdGVtIiwiYW5pbWF0ZVBsYXlFbmQiLCJfaW5pdFRvdWNoRXZlbnQiLCJfc3RhdHMiLCJ1cGRhdGUiLCJUaWNrZXIiLCJ0aW1pbmdNb2RlIiwiUkFGIiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9vblRpY2siLCJiaW5kIiwiZm9yRWFjaCIsInNldCIsInBsYXkiLCJyZW1vdmVBbGxFdmVudExpc3RlbmVycyIsInBvcyIsImFicyIsIl91cGRhdGVBbmltYXRvcnMiLCJzdGF0cyIsImFuaW1hdGVQbGF5U3RhcnQiLCJkdXJhdGlvbiIsImUiLCJ0b3VjaGVzIiwiY2xpZW50WSIsImNsaWVudFgiLCJtYW5pZmVzdCIsIm9uUHJvZ3Jlc3MiLCJmaWxlTGlzdCIsIkFycmF5IiwiaXNBcnJheSIsImxlbmd0aCIsInNyYyIsImxvYWRlZE51bWJlciIsInByZWxvYWROdW1iZXIiLCJpbWFnZXMiLCJpIiwiaW1hZ2UiLCJJbWFnZSIsImZpbGUiLCJmaWxlVHlwZSIsIm9ubG9hZCIsInByb2dyZXNzIiwiZmxvb3IiLCJ0eXBlIiwiU2hhcGUiLCJCaXRtYXAiLCJUZXh0Iiwic2hlZXQiLCJzcHJpdGVTaGVldCIsIlNwcml0ZVNoZWV0IiwiU3ByaXRlIiwiQ29udGFpbmVyIiwibmFtZSIsInBhcmVudF9pZCIsInBhcmVudElkIiwicHJvcCIsIk9iamVjdCIsImtleXMiLCJwcm9wS2V5Iiwia2V5IiwiYWxpZ24iLCJtZXRob2QiLCJldmVudCIsImhhbmRsZSIsImJvdW5kcyIsImN1c3RvbSIsImZyb20iLCJfYWRkT2JqIiwiZ3JvdXAiLCJ0YWJsZSIsInJlZ1giLCJyZWdZIiwic2NhbGVYIiwic2NhbGVZIiwicm90YXRpb24iLCJhbHBoYSIsInZpc2libGUiLCJhZGRDaGlsZCIsImdyb3VwRW5kIiwic2tld1giLCJza2V3WSIsInRvcCIsInNwcml0ZSIsInN0YXJ0QnlJZCIsImVuZEJ5SWQiLCJhZnRlckJ5SWQiLCJtdXNpY0J5SWQiLCJtYXBQb3MiLCJfaW5pdEFuaW1hdGVQb3NpdGlvbiIsInN0YXJ0WCIsInN0YXJ0WSIsImVuZFgiLCJlbmRZIiwiaW5pdEFscGhhIiwiaW5pdFNjYWxlWCIsImluaXRTY2FsZVkiLCJpbml0U2tld1giLCJpbml0U2tld1kiLCJpbml0Um90YXRpb24iLCJpc011c2ljIiwiaXNQbGF5IiwiY3R4Iiwic3VtIiwiX2NvdW50U3VtWSIsInBhcmVudCIsIl9hbmltYXRlIiwicmF0ZSIsImR1cmF0aW9uU2VnbWVudCIsImN1cnJlbnRJbmRleCIsIm1pbiIsIm11c2ljIiwiY3VycmVudFRpbWUiLCJwYXVzZSIsImxvb3AiLCJTdGF0cyIsInNob3dQYW5lbCIsImJvZHkiLCJhcHBlbmRDaGlsZCIsImRvbSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQXVCTUEsVztBQUVGLHlCQUFhQyxPQUFiLEVBQXNCO0FBQUE7O0FBRWxCLFlBQUlBLFFBQVFDLEVBQVIsS0FBZSxFQUFuQixFQUF1QjtBQUNuQkMsb0JBQVFDLEtBQVIsQ0FBYyxjQUFkO0FBQ0g7O0FBRUQsYUFBS0MsS0FBTCxHQUFhSixRQUFRSSxLQUFSLElBQWlCQyxPQUFPQyxVQUFyQztBQUNBLGFBQUtDLE1BQUwsR0FBY1AsUUFBUU8sTUFBUixJQUFrQkYsT0FBT0csV0FBdkM7QUFDQSxhQUFLQyxNQUFMLEdBQWMsSUFBSUMsU0FBU0MsS0FBYixDQUFtQkMsU0FBU0MsY0FBVCxDQUF3QmIsUUFBUUMsRUFBaEMsQ0FBbkIsQ0FBZDtBQUNBLGFBQUtRLE1BQUwsQ0FBWUssTUFBWixDQUFtQlYsS0FBbkIsR0FBMkIsS0FBS0EsS0FBaEM7QUFDQSxhQUFLSyxNQUFMLENBQVlLLE1BQVosQ0FBbUJQLE1BQW5CLEdBQTRCLEtBQUtBLE1BQWpDO0FBQ0EsYUFBS1EsVUFBTCxHQUFrQixJQUFsQjtBQUNBLGFBQUtDLFVBQUwsR0FBa0IsS0FBbEI7QUFDQSxhQUFLQyxNQUFMLEdBQWMsS0FBZDtBQUNBLGFBQUtDLFNBQUwsR0FBaUI7QUFDYkMsd0JBQVksWUFEQztBQUViQyxzQkFBVTtBQUZHLFNBQWpCOztBQUtBLGFBQUtDLFVBQUwsR0FBa0IsQ0FBQ3JCLFFBQVFzQixTQUFSLElBQXFCLEtBQUtKLFNBQUwsQ0FBZUUsUUFBckMsTUFBbUQsS0FBS0YsU0FBTCxDQUFlRSxRQUFwRjtB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QUFDM0NxRSxzQ0FBTUUsS0FBTjtBQUNBYiwwQ0FBVSxLQUFWO0FBQ0g7O0FBRUQsZ0NBQUlXLE1BQU1HLElBQU4sSUFBY2QsWUFBWSxJQUExQixJQUFrQzFELGFBQWEsQ0FBbkQsRUFBc0Q7QUFDbERxRSxzQ0FBTUUsS0FBTjtBQUNBYiwwQ0FBVSxLQUFWO0FBQ0g7QUFDSjtBQUNKOztBQUVETSw2QkFBU0MsSUFBVDtBQUNILGlCQXhDRTtBQXlDSDlGLG1CQXpDRyxlQXlDQzhGLElBekNELEVBeUNPO0FBQ04sd0JBQUlOLE1BQUosRUFBWUEsU0FBUyxLQUFUO0FBQ1osd0JBQUlELE9BQUosRUFBYUEsVUFBVSxLQUFWOztBQUViTSw2QkFBU0MsSUFBVDtBQUNIO0FBOUNFLGFBQVA7QUFnREg7OztpQ0FFUztBQUNOLGlCQUFLeEYsS0FBTCxHQUFhLElBQUlnRyxLQUFKLEVBQWI7QUFDQSxpQkFBS2hHLEtBQUwsQ0FBV2lHLFNBQVgsQ0FBcUIsQ0FBckIsRUFGTSxDQUVtQjtBQUN6QjVLLHFCQUFTNkssSUFBVCxDQUFjQyxXQUFkLENBQTBCLEtBQUtuRyxLQUFMLENBQVdvRyxHQUFyQztBQUNIIiwiZmlsZSI6InRpbWUtZ2FsbGVyeS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqICBAV2lkdGg6IOeUu+W4g+WuvVxuICogIEBIZWlnaHQ6IOeUu+W4g+mrmFxuICogIEBpc1N0YXRlOiDmmK/lkKblkK/liqggU3RhZ2UuanMg5rWL6K+VRlBTLCDkvp3otZYgc3RhZ2UuanNcbiAqICBAaXNMb2c6IOaYr+WQpuaJk+WNsOaVsOaNrue7k+aehFxuICogIEBkaXJlY3Rpb246IOWPr+iuvue9ruawtOW5syhob3Jpem9udGFsKeaIluWeguebtCh2ZXJ0aWNhbClcbiAqICBAcmVzb3VyY2VzUGF0aDog5Zu+54mH6LWE5rqQ5Yqg6L2955qE6buY6K6k6Lev5YqyXG4gKiAgQHJlc291cmNlczog5Zu+54mH6LWE5rqQXG4gKiAgQHNwcml0ZXM6IOiHquWumuS5iembqueip+WbvuaVsOaNruaVsOe7hO+8jOaWueS+v+WIm+W7uuaVsOaNrueahOaXtuWAmeWPr+maj+aXtuiwg+eUqOmbqueip+WbvlxuICogIEBkYXRhOiDliJvlu7rnlLvluIPmlbDmja5cbiAqICBAb25Jbml0OiDliJ3lp4vljJblkI7nmoTlm57osINcbiAqICBAb25FbmQ6IOe7k+adn+WQjueahOWbnuiwg1xuICogIEBvblRpY2tTdGFydDog5q+P5LiA5bin55qE5byA5aeL5YmN5Zue6LCDXG4gKiAgQG9uVGlja0VuZDog5q+P5LiA5bin55qE57uT5p2f5ZCO5Zue6LCDXG4gKiAgQG1hcFN0YXJ0OiDlrprkuYnnlLvluIPlp4vngrnkvY3nva5cbiAqICBAbWFwQWN0aXZlOiDlrprkuYnnlLvluIPlvZPliY3nmoTmkq3mlL7nmoTkvY3nva7vvIjlj6/mlrnkvr/mtYvor5XvvIlcbiAqICBAbWFwRW5kOiDnlLvluIPpu5jorqTnu5PmnZ/kvY3nva7vvIzpu5jorqTmmK8gYW5pbWF0ZVBsYXlFbmQg5pyA5aSn5YC85oiW5Zyw5Zu+55qE6auY5bqmXG4gKiAgQG1hcFBsYXk6IOWumuS5ieeUu+W4g+aSreaUvuWKqOeUu+eahOS9jee9ru+8iOm7mOiupOWFg+e0oOWGjeWxj+W5leW6lemDqOeahOS9jee9ruW8gOWni+aSreaUvuWKqOeUu++8iVxuICogIEB0b3VjaFNwZWVkOiDlrprkuYnnlKjmiLfmu5HliqjpgJ/luqbvvIzotorlpKfvvIzmu5HliqjnmoTpgJ/luqbotorlv6tcbiAqICBAYXV0b1BsYXk6IOaYr+WQpuiHquWKqOaSreaUvlxuICogIEBhdXRvU3BlZWQ6IOiHquWKqOaSreaUvumAn+W6plxuICovXG5cbmNsYXNzIFRpbWVHYWxsZXJ5IHtcblxuICAgIGNvbnN0cnVjdG9yIChvcHRpb25zKSB7XG5cbiAgICAgICAgaWYgKG9wdGlvbnMuaWQgPT09ICcnKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdJRCBub3QgZXhpc3QnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMud2lkdGggPSBvcHRpb25zLndpZHRoIHx8IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgICAgICB0aGlzLmhlaWdodCA9IG9wdGlvbnMuaGVpZ2h0IHx8IHdpbmRvdy5pbm5lckhlaWdodDtcbiAgICAgICAgdGhpcy5fc3RhZ2UgPSBuZXcgY3JlYXRlanMuU3RhZ2UoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQob3B0aW9ucy5pZCkpO1xuICAgICAgICB0aGlzLl9zdGFnZS5jYW52YXMud2lkdGggPSB0aGlzLndpZHRoO1xuICAgICAgICB0aGlzLl9zdGFnZS5jYW52YXMuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG4gICAgICAgIHRoaXMuX2xvYWRRdWV1ZSA9IG51bGw7XG4gICAgICAgIHRoaXMuX2lzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9pc0VuZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9kaXJHcm91cCA9IHtcbiAgICAgICAgICAgIGhvcml6b250YWw6ICdob3Jpem9udGFsJyxcbiAgICAgICAgICAgIHZlcnRpY2FsOiAndmVydGljYWwnXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5pc1ZlcnRpY2FsID0gKG9wdGlvbnMuZGlyZWN0aW9uIHx8IHRoaXMuX2Rpckdyb3VwLnZlcnRpY2FsKSA9PT0gdGhpcy5fZGlyR3JvdXAudmVydGljYWw7XG4gICAgICAgIHRoaXMuaXNNb3ZpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pc1N0YXRlID0gb3B0aW9ucy5pc1N0YXRlIHx8IGZhbHNlO1xuICAgICAgICB0aGlzLmlzTG9nID0gb3B0aW9ucy5pc0xvZyB8fCBmYWxzZTtcblxuICAgICAgICB0aGlzLmF1dG9QbGF5ID0gb3B0aW9ucy5hdXRvUGxheSB8fCBmYWxzZTtcbiAgICAgICAgdGhpcy5hdXRvU3BlZWQgPSBvcHRpb25zLmF1dG9TcGVlZCB8fCAxO1xuXG4gICAgICAgIHRoaXMucmVzb3VyY2VzUGF0aCA9IG9wdGlvbnMucmVzb3VyY2VzUGF0aCB8fCAnJztcbiAgICAgICAgdGhpcy5yZXNvdXJjZXMgPSBvcHRpb25zLnJlc291cmNlcyB8fCBbXTtcbiAgICAgICAgdGhpcy5zcHJpdGVzID0gb3B0aW9ucy5zcHJpdGVzIHx8IHt9O1xuICAgICAgICB0aGlzLmRhdGEgPSBvcHRpb25zLmRhdGEgfHwgW107XG5cbiAgICAgICAgdGhpcy5vbkluaXQgPSBvcHRpb25zLm9uSW5pdCB8fCBudWxsO1xuICAgICAgICB0aGlzLm9uRW5kID0gb3B0aW9ucy5vbkVuZCB8fCBudWxsO1xuICAgICAgICB0aGlzLm9uVGlja1N0YXJ0ID0gb3B0aW9ucy5vblRpY2tTdGFydCB8fCBudWxsO1xuICAgICAgICB0aGlzLm9uVGlja0VuZCA9IG9wdGlvbnMub25UaWNrRW5kIHx8IG51bGw7XG5cbiAgICAgICAgdGhpcy5tYXBTdGFydCA9IG9wdGlvbnMubWFwU3RhcnQgfHwgMDtcbiAgICAgICAgdGhpcy5tYXBBY3RpdmUgPSBvcHRpb25zLm1hcEFjdGl2ZSB8fCAwO1xuICAgICAgICB0aGlzLm1hcEVuZCA9IG9wdGlvbnMubWFwRW5kIHx8IDA7XG4gICAgICAgIHRoaXMubWFwUGxheSA9IG9wdGlvbnMubWFwUGxheSB8fCAodGhpcy5pc1ZlcnRpY2FsPyB0aGlzLmhlaWdodCA6IHRoaXMud2lkdGgpO1xuXG4gICAgICAgIHRoaXMub2JqZWN0cyA9IHt9O1xuICAgICAgICB0aGlzLmFuaW1hdG9yc0dyb3VwID0gW107ICAgICAgICAgICAgICAvLyDmiafooYzliqjnlLvnmoTmlbDnu4RcbiAgICAgICAgdGhpcy50b3VjaERhdGEgPSB7XG4gICAgICAgICAgICB0b3VjaHN0YXJ0OiAwLFx0XHRcdCAgICAgICAgICAgLy8gVG91Y2hTdGFydCDliJ3lp4sgWSDkvY3nva5cbiAgICAgICAgICAgIHRvdWNobW92ZTogMCwgICAgICAgICAgICAgICAgICAgICAgLy8gVG91Y2hNb3ZlICDliJ3lp4sgWSDot53nprtcbiAgICAgICAgICAgIGZyaWN0aW9uIDogMC45LFx0XHQgICAgICAgICAgICAgICAvLyDmkanmk6blgLxcbiAgICAgICAgICAgIHNwZWVkOiBvcHRpb25zLnRvdWNoU3BlZWQgfHwgMSwgICAgLy8gVG91Y2gg5ruR5Yqo6YCf5bqmXG4gICAgICAgICAgICBpc0luZXJ0YW5jZTogZmFsc2UgICAgICAgICAgICAgICAgIC8vIOaDr+aAp1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuaW5pdCgpO1xuICAgIH1cblxuICAgIGluaXQoKSB7XG4gICAgICAgIHRoaXMuX3ByZWxvYWQodGhpcy5yZXNvdXJjZXMsIHtcbiAgICAgICAgICAgIHBhdGg6IHRoaXMucmVzb3VyY2VzUGF0aCxcbiAgICAgICAgICAgIG9uQ29tcGxldGU6ICgpID0+IHtcblxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpcy5zcHJpdGVzID09PSAnZnVuY3Rpb24nKSB0aGlzLnNwcml0ZXMgPSB0aGlzLnNwcml0ZXModGhpcyk7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmRhdGEgPT09ICdmdW5jdGlvbicpIHRoaXMuZGF0YSA9IHRoaXMuZGF0YSh0aGlzKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAnbWFwJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiB0aGlzLmRhdGFcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgICAgICAvLyDmuLLmn5Plm77lg4/mlbDmja5cbiAgICAgICAgICAgICAgICB0aGlzLl9yZW5kZXIoZGF0YSwgbnVsbCwgKGRpc3BsYXlPYmplY3QsIG9iaikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGlzcGxheU9iamVjdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5hbmltYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5T2JqZWN0LmFuaW1hdGlvbiA9IHRoaXMuX2NyZWF0ZUFuaW1hdGUoZGlzcGxheU9iamVjdCwgb2JqLmFuaW1hdGlvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hbmltYXRvcnNHcm91cC5wdXNoKHtkaXNwbGF5T2JqZWN0fSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHRoaXMubWFwID0gdGhpcy5vYmplY3RzWydtYXAnXTtcblxuICAgICAgICAgICAgICAgIGxldCBtYXBBY3RpdmUgPSB0aGlzLm1hcEFjdGl2ZT8gLXRoaXMubWFwQWN0aXZlIDogLXRoaXMubWFwU3RhcnQ7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1ZlcnRpY2FsKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWFwLnkgPSBtYXBBY3RpdmVcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1hcC54ID0gbWFwQWN0aXZlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5tYXBFbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IG1hcExvbmc7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzVmVydGljYWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcExvbmcgPSB0aGlzLm1hcC5nZXRCb3VuZHMoKS5oZWlnaHQgKyB0aGlzLm1hcC5nZXRCb3VuZHMoKS55IC0gdGhpcy5oZWlnaHQ7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXBMb25nID0gdGhpcy5tYXAuZ2V0Qm91bmRzKCkud2lkdGggKyB0aGlzLm1hcC5nZXRCb3VuZHMoKS54IC0gdGhpcy53aWR0aDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBsZXQgbWF4QW5pbWF0ZVBsYXlFbmQgPSBNYXRoLm1heC5hcHBseShNYXRoLCB0aGlzLmFuaW1hdG9yc0dyb3VwLm1hcCgoaXRlbSkgPT4ge3JldHVybiBpdGVtLmRpc3BsYXlPYmplY3QuYW5pbWF0aW9uLmFuaW1hdGVQbGF5RW5kfSkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1hcEVuZCA9IE1hdGgubWF4KG1hcExvbmcsIG1heEFuaW1hdGVQbGF5RW5kKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyDliJ3lp4vljJbmu5Hliqjkuovku7ZcbiAgICAgICAgICAgICAgICB0aGlzLl9pbml0VG91Y2hFdmVudCgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMub25Jbml0KSB0aGlzLm9uSW5pdCgpO1xuXG4gICAgICAgICAgICAgICAgLy8g5piv5ZCm5omT5Y2wIEZQUyDnirbmgIHvvIzkvp3otZYgc3RhdGUuanNcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1N0YXRlKSB0aGlzLl9zdGF0cygpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5fc3RhZ2UudXBkYXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNyZWF0ZWpzLlRpY2tlci50aW1pbmdNb2RlID0gY3JlYXRlanMuVGlja2VyLlJBRjtcbiAgICB9XG5cbiAgICBwbGF5KCkge1xuICAgICAgICBjcmVhdGVqcy5UaWNrZXIuYWRkRXZlbnRMaXN0ZW5lcigndGljaycsIHRoaXMuX29uVGljay5iaW5kKHRoaXMpKTtcbiAgICB9XG4gICAgXG4gICAgcmVwbGF5KCkge1xuICAgICAgICB0aGlzLl9pc0VuZCA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMudG91Y2hEYXRhLnRvdWNoc3RhcnQgPSAwO1xuICAgICAgICB0aGlzLnRvdWNoRGF0YS50b3VjaG1vdmUgPSAwO1xuICAgICAgICB0aGlzLnRvdWNoRGF0YS5pc0luZXJ0YW5jZSA9IGZhbHNlO1xuXG4gICAgICAgIGlmICh0aGlzLmlzVmVydGljYWwpIHtcbiAgICAgICAgICAgIHRoaXMubWFwLnkgPSAtdGhpcy5tYXBTdGFydDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubWFwLnggPSAtdGhpcy5tYXBTdGFydDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuYW5pbWF0b3JzR3JvdXAuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgaXRlbS5kaXNwbGF5T2JqZWN0LmFuaW1hdGlvbi5zZXQoMCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuX3N0YWdlLnVwZGF0ZSgpO1xuXG4gICAgICAgIHRoaXMucGxheSgpO1xuICAgIH1cblxuICAgIHN0b3AoKSB7XG4gICAgICAgIGNyZWF0ZWpzLlRpY2tlci5yZW1vdmVBbGxFdmVudExpc3RlbmVycygpO1xuICAgIH1cblxuICAgIGdldEltYWdlKGlkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9sb2FkUXVldWVbaWRdO1xuICAgIH1cblxuICAgIF9vblRpY2soKSB7XG4gICAgICAgIGlmICghdGhpcy5faXNMb2FkaW5nICYmIHRoaXMubWFwKSB7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmF1dG9QbGF5IHx8IHRoaXMuaXNNb3ZpbmcpIHtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9uVGlja1N0YXJ0KSB0aGlzLm9uVGlja1N0YXJ0KHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgbGV0IHBvcztcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmF1dG9QbGF5KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzVmVydGljYWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWFwLnkgLT0gdGhpcy5hdXRvU3BlZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb3MgPSAtdGhpcy5tYXAueTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWFwLnggLT0gdGhpcy5hdXRvU3BlZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb3MgPSAtdGhpcy5tYXAueDtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRvdWNoRGF0YS50b3VjaG1vdmUgIT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudG91Y2hEYXRhLnRvdWNoc3RhcnQgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50b3VjaERhdGEudG91Y2htb3ZlID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudG91Y2hEYXRhLmlzSW5lcnRhbmNlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzTW92aW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaXNNb3ZpbmcpIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyDlpoLmnpzmmK/mg6/mgKdcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudG91Y2hEYXRhLmlzSW5lcnRhbmNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDmg6/mgKflh4/pgJ9cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudG91Y2hEYXRhLnRvdWNobW92ZSAqPSB0aGlzLnRvdWNoRGF0YS5mcmljdGlvbjtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHRoaXMudG91Y2hEYXRhLnRvdWNobW92ZSkgPD0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudG91Y2hEYXRhLnRvdWNoc3RhcnQgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudG91Y2hEYXRhLnRvdWNobW92ZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50b3VjaERhdGEuaXNJbmVydGFuY2UgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzTW92aW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyDmoLnmja7mu5HliqjnmoTkvY3nva7orrDlvZXliqjnlLvmiafooYxcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNWZXJ0aWNhbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXAueSArPSB0aGlzLnRvdWNoRGF0YS50b3VjaG1vdmUgKiB0aGlzLnRvdWNoRGF0YS5zcGVlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IC10aGlzLm1hcC55O1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXAueCArPSB0aGlzLnRvdWNoRGF0YS50b3VjaG1vdmUgKiB0aGlzLnRvdWNoRGF0YS5zcGVlZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IC10aGlzLm1hcC54O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHBvcyA8IHRoaXMubWFwU3RhcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNWZXJ0aWNhbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXAueSA9IC10aGlzLm1hcFN0YXJ0O1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXAueCA9IC10aGlzLm1hcFN0YXJ0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHBvcyA+IHRoaXMubWFwRW5kKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2lzRW5kKSByZXR1cm47XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faXNFbmQgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzVmVydGljYWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubWFwLnkgPSAtdGhpcy5tYXBFbmQ7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1hcC54ID0gLXRoaXMubWFwRW5kO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub25FbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25FbmQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHRoaXMubWFwQWN0aXZlID0gdGhpcy5pc1ZlcnRpY2FsPyAtdGhpcy5tYXAueSA6IC10aGlzLm1hcC54O1xuXG4gICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlQW5pbWF0b3JzKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmlzU3RhdGUpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdHMudXBkYXRlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfdXBkYXRlQW5pbWF0b3JzKCkge1xuICAgICAgICBsZXQgcG9zID0gdGhpcy5pc1ZlcnRpY2FsPyAtdGhpcy5tYXAueSA6IC10aGlzLm1hcC54O1xuXG4gICAgICAgIHRoaXMuYW5pbWF0b3JzR3JvdXAubWFwKChvYmopID0+IHtcbiAgICAgICAgICAgIGxldCBkaXNwbGF5T2JqZWN0ID0gb2JqLmRpc3BsYXlPYmplY3Q7XG4gICAgICAgICAgICBsZXQgYW5pbWF0ZVBsYXlTdGFydCA9IGRpc3BsYXlPYmplY3QuYW5pbWF0aW9uLmFuaW1hdGVQbGF5U3RhcnQ7XG4gICAgICAgICAgICBsZXQgYW5pbWF0ZVBsYXlFbmQgICA9IGRpc3BsYXlPYmplY3QuYW5pbWF0aW9uLmFuaW1hdGVQbGF5RW5kO1xuXG4gICAgICAgICAgICBpZiAocG9zID49IGFuaW1hdGVQbGF5U3RhcnQgJiYgcG9zIDwgYW5pbWF0ZVBsYXlFbmQgKSB7XG4gICAgICAgICAgICAgICAgbGV0IGR1cmF0aW9uID0gTWF0aC5hYnMocG9zIC0gYW5pbWF0ZVBsYXlTdGFydCk7XG4gICAgICAgICAgICAgICAgZGlzcGxheU9iamVjdC5hbmltYXRpb24udXBkYXRlKGR1cmF0aW9uKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocG9zIDwgYW5pbWF0ZVBsYXlTdGFydCkge1xuICAgICAgICAgICAgICAgIGRpc3BsYXlPYmplY3QuYW5pbWF0aW9uLnVwZGF0ZSgwKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocG9zID4gYW5pbWF0ZVBsYXlFbmQpIHtcbiAgICAgICAgICAgICAgICBkaXNwbGF5T2JqZWN0LmFuaW1hdGlvbi51cGRhdGUoYW5pbWF0ZVBsYXlFbmQgLSBhbmltYXRlUGxheVN0YXJ0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHRoaXMub25UaWNrRW5kKSB0aGlzLm9uVGlja0VuZCh0aGlzKTtcblxuICAgICAgICB0aGlzLl9zdGFnZS51cGRhdGUoKTtcbiAgICB9XG5cbiAgICAvLyDliJ3lp4vljJbmiYvlir9cbiAgICBfaW5pdFRvdWNoRXZlbnQoKSB7XG5cbiAgICAgICAgdGhpcy5fc3RhZ2UuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCAoZSkgPT4ge1xuXG4gICAgICAgICAgICBpZiAodGhpcy5hdXRvUGxheSkgcmV0dXJuO1xuXG4gICAgICAgICAgICBpZiAodGhpcy5pc1ZlcnRpY2FsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy50b3VjaERhdGEudG91Y2hzdGFydCA9IGUudG91Y2hlc1swXS5jbGllbnRZO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRvdWNoRGF0YS50b3VjaHN0YXJ0ID0gZS50b3VjaGVzWzBdLmNsaWVudFg7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMudG91Y2hEYXRhLmlzSW5lcnRhbmNlID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLmlzTW92aW5nID0gZmFsc2U7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuX3N0YWdlLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCAoZSkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNWZXJ0aWNhbCkge1xuICAgICAgICAgICAgICAgIHRoaXMudG91Y2hEYXRhLnRvdWNobW92ZSA9IGUudG91Y2hlc1swXS5jbGllbnRZIC0gdGhpcy50b3VjaERhdGEudG91Y2hzdGFydDtcbiAgICAgICAgICAgICAgICB0aGlzLnRvdWNoRGF0YS50b3VjaHN0YXJ0ID0gZS50b3VjaGVzWzBdLmNsaWVudFk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudG91Y2hEYXRhLnRvdWNobW92ZSA9IGUudG91Y2hlc1swXS5jbGllbnRYIC0gdGhpcy50b3VjaERhdGEudG91Y2hzdGFydDtcbiAgICAgICAgICAgICAgICB0aGlzLnRvdWNoRGF0YS50b3VjaHN0YXJ0ID0gZS50b3VjaGVzWzBdLmNsaWVudFg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmlzTW92aW5nID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5fc3RhZ2UuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuYXV0b1BsYXkpIHJldHVybjtcbiAgICAgICAgICAgIHRoaXMudG91Y2hEYXRhLmlzSW5lcnRhbmNlID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICBfcHJlbG9hZChtYW5pZmVzdCA9IFtdLCB7IG9uQ29tcGxldGUgPSAoKSA9PiB7fSwgb25Qcm9ncmVzcyA9ICgpID0+IHt9LCBwYXRoID0gJyd9ID0ge30pIHtcblxuICAgICAgICB0aGlzLl9pc0xvYWRpbmcgPSB0cnVlO1xuXG4gICAgICAgIGxldCBmaWxlTGlzdCA9IG51bGw7XG5cbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkobWFuaWZlc3QpKSB7XG4gICAgICAgICAgICBpZiAobWFuaWZlc3QubGVuZ3RoID09PSAwKSByZXR1cm47XG4gICAgICAgICAgICBmaWxlTGlzdCA9IG1hbmlmZXN0O1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZihtYW5pZmVzdCkgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBmaWxlTGlzdCA9IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHNyYzogbWFuaWZlc3QsXG4gICAgICAgICAgICAgICAgICAgIGlkOiBtYW5pZmVzdFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF07XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mKG1hbmlmZXN0KSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIGlmICghbWFuaWZlc3QuaWQpIHtcbiAgICAgICAgICAgICAgICBtYW5pZmVzdC5pZCA9IG1hbmlmZXN0LnNyYztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpbGVMaXN0ID0gW21hbmlmZXN0XTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBsb2FkZWROdW1iZXIgPSAwO1xuICAgICAgICBsZXQgcHJlbG9hZE51bWJlciA9IGZpbGVMaXN0Lmxlbmd0aDtcbiAgICAgICAgbGV0IGltYWdlcyA9IHt9O1xuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcHJlbG9hZE51bWJlcjsgaSsrKSB7XG4gICAgICAgICAgICBsZXQgaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgICAgIGxldCBmaWxlID0gZmlsZUxpc3RbaV07XG4gICAgICAgICAgICBsZXQgZmlsZVR5cGUgPSB0eXBlb2YoZmlsZSk7XG4gICAgICAgICAgICBsZXQgc3JjID0gJyc7XG5cbiAgICAgICAgICAgIGlmIChmaWxlVHlwZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICBzcmMgPSBmaWxlLnNyYztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZmlsZVR5cGUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgc3JjID0gZmlsZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaW1hZ2Uuc3JjID0gcGF0aCArIHNyYztcbiAgICAgICAgICAgIGltYWdlLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZmlsZS5pZCkge1xuICAgICAgICAgICAgICAgICAgICBpbWFnZXNbZmlsZS5pZF0gPSBpbWFnZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpbWFnZXNbc3JjXSA9IGltYWdlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsb2FkZWROdW1iZXIrKztcblxuICAgICAgICAgICAgICAgIGxldCBwcm9ncmVzcyA9IE1hdGguZmxvb3IobG9hZGVkTnVtYmVyL3ByZWxvYWROdW1iZXIgKiAxMDApO1xuICAgICAgICAgICAgICAgIG9uUHJvZ3Jlc3MocHJvZ3Jlc3MpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHByb2dyZXNzID49IDEwMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbG9hZFF1ZXVlID0gaW1hZ2VzO1xuICAgICAgICAgICAgICAgICAgICBvbkNvbXBsZXRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHRoaXMuX2xvYWRRdWV1ZSA9IG5ldyBjcmVhdGVqcy5Mb2FkUXVldWUodHJ1ZSwgcGF0aCk7XG4gICAgICAgIC8vXG4gICAgICAgIC8vIGlmIChwcm9ncmVzcykgdGhpcy5fbG9hZFF1ZXVlLm9uKCdwcm9ncmVzcycsIGUgPT4gb25Qcm9ncmVzcyhlKSk7XG4gICAgICAgIC8vXG4gICAgICAgIC8vIHRoaXMuX2xvYWRRdWV1ZS5vbignY29tcGxldGUnLCBlID0+IHtcbiAgICAgICAgLy8gICAgIHRoaXMuX2lzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAvLyAgICAgaWYgKG9uQ29tcGxldGUpIG9uQ29tcGxldGUoZSk7XG4gICAgICAgIC8vIH0pO1xuICAgICAgICAvL1xuICAgICAgICAvLyB0aGlzLl9sb2FkUXVldWUubG9hZE1hbmlmZXN0KGxvYWRNYW5pZmVzdCk7XG5cbiAgICB9XG5cbiAgICBfYWRkT2JqKG9iaiA9IHt9KSB7XG5cbiAgICAgICAgbGV0IGRpc3BsYXlPYmplY3QgPSBudWxsO1xuXG4gICAgICAgIHN3aXRjaCAob2JqLnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ3NoYXBlJzpcbiAgICAgICAgICAgICAgICBkaXNwbGF5T2JqZWN0ID0gbmV3IGNyZWF0ZWpzLlNoYXBlKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdiaXRtYXAnOlxuICAgICAgICAgICAgICAgIGlmIChvYmouaW1hZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheU9iamVjdCA9IG5ldyBjcmVhdGVqcy5CaXRtYXAob2JqLmltYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd0ZXh0JzpcbiAgICAgICAgICAgICAgICBkaXNwbGF5T2JqZWN0ID0gbmV3IGNyZWF0ZWpzLlRleHQoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3Nwcml0ZSc6XG4gICAgICAgICAgICAgICAgaWYgKG9iai5zaGVldCkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgc3ByaXRlU2hlZXQgPSBuZXcgY3JlYXRlanMuU3ByaXRlU2hlZXQob2JqLnNoZWV0KTtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheU9iamVjdCA9IG5ldyBjcmVhdGVqcy5TcHJpdGUoc3ByaXRlU2hlZXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgZGlzcGxheU9iamVjdCA9IG5ldyBjcmVhdGVqcy5Db250YWluZXIoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvYmoudHlwZSkge1xuICAgICAgICAgICAgZGlzcGxheU9iamVjdC50eXBlID0gb2JqLnR5cGU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkaXNwbGF5T2JqZWN0LnR5cGUgPSAnY29udGFpbmVyJztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvYmouaWQpIGRpc3BsYXlPYmplY3QubmFtZSA9IG9iai5pZDtcblxuICAgICAgICBpZiAob2JqLnBhcmVudF9pZCkgZGlzcGxheU9iamVjdC5wYXJlbnRJZCA9IG9iai5wYXJlbnRfaWQ7XG5cbiAgICAgICAgaWYgKG9iai5wcm9wKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBwcm9wS2V5IG9mIE9iamVjdC5rZXlzKG9iai5wcm9wKSkge1xuICAgICAgICAgICAgICAgIC8vIOWIpOaWreWxnuaAp+exu+Wei1xuICAgICAgICAgICAgICAgIGlmIChkaXNwbGF5T2JqZWN0W3Byb3BLZXldIGluc3RhbmNlb2YgT2JqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGtleSBvZiBPYmplY3Qua2V5cyhvYmoucHJvcFtwcm9wS2V5XSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGlzcGxheU9iamVjdFtwcm9wS2V5XVtrZXldID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU9iamVjdFtwcm9wS2V5XVtrZXldKC4uLm9iai5wcm9wW3Byb3BLZXldW2tleV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5T2JqZWN0W3Byb3BLZXldW2tleV0gPSBvYmoucHJvcFtwcm9wS2V5XVtrZXldO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZGlzcGxheU9iamVjdFtwcm9wS2V5XSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5T2JqZWN0W3Byb3BLZXldKC4uLm9iai5wcm9wW3Byb3BLZXldKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5T2JqZWN0W3Byb3BLZXldID0gb2JqLnByb3BbcHJvcEtleV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAob2JqLnR5cGUgPT09ICd0ZXh0JyAmJiBvYmoucHJvcC5hbGlnbikge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAob2JqLnByb3AuYWxpZ24pIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnY2VudGVyJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlPYmplY3QueCA9ICh0aGlzLndpZHRoIC0gZGlzcGxheU9iamVjdC5nZXRCb3VuZHMoKS53aWR0aCkvMjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdyaWdodCc6XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5T2JqZWN0LnggPSB0aGlzLndpZHRoIC0gZGlzcGxheU9iamVjdC5nZXRCb3VuZHMoKS53aWR0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU9iamVjdC54ID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob2JqLm1ldGhvZCkge1xuICAgICAgICAgICAgZm9yIChsZXQga2V5IG9mIE9iamVjdC5rZXlzKG9iai5tZXRob2QpKSB7XG4gICAgICAgICAgICAgICAgZGlzcGxheU9iamVjdFtrZXldKC4uLm9iai5tZXRob2Rba2V5XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob2JqLmV2ZW50KSB7XG4gICAgICAgICAgICBpZiAob2JqLmV2ZW50LmhhbmRsZSkge1xuICAgICAgICAgICAgICAgIGxldCB0eXBlID0gb2JqLmV2ZW50LnR5cGUgfHwgJ2NsaWNrJztcbiAgICAgICAgICAgICAgICBkaXNwbGF5T2JqZWN0LmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgb2JqLmV2ZW50LmhhbmRsZSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkaXNwbGF5T2JqZWN0LmdldEJvdW5kcygpKSB7XG4gICAgICAgICAgICBsZXQgYm91bmRzID0gZGlzcGxheU9iamVjdC5nZXRCb3VuZHMoKTtcbiAgICAgICAgICAgIGRpc3BsYXlPYmplY3Qud2lkdGggPSBib3VuZHMud2lkdGg7XG4gICAgICAgICAgICBkaXNwbGF5T2JqZWN0LmhlaWdodCA9IGJvdW5kcy5oZWlnaHQ7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZGlzcGxheU9iamVjdDtcblxuICAgIH1cblxuICAgIF9yZW5kZXIoZGF0YSA9IFtdLCBwYXJlbnRfaWQsIGN1c3RvbSA9ICgpID0+IHt9KSB7XG5cbiAgICAgICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBPYmplY3QpIHtcbiAgICAgICAgICAgIGRhdGEgPSBBcnJheS5mcm9tKGRhdGEpXG4gICAgICAgIH1cblxuICAgICAgICBkYXRhLm1hcCgob2JqKSA9PiB7XG5cbiAgICAgICAgICAgIG9iai5wYXJlbnRfaWQgPSBwYXJlbnRfaWQ7XG5cbiAgICAgICAgICAgIHRoaXMub2JqZWN0c1tvYmouaWRdID0gdGhpcy5fYWRkT2JqKG9iaik7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmlzTG9nKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5ncm91cChvYmouaWQgKyAnOicpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUudGFibGUoe1xuICAgICAgICAgICAgICAgICAgICB4IDogdGhpcy5vYmplY3RzW29iai5pZF0ueCxcbiAgICAgICAgICAgICAgICAgICAgeSA6IHRoaXMub2JqZWN0c1tvYmouaWRdLnksXG4gICAgICAgICAgICAgICAgICAgIHJlZ1ggOiB0aGlzLm9iamVjdHNbb2JqLmlkXS5yZWdYLFxuICAgICAgICAgICAgICAgICAgICByZWdZIDogdGhpcy5vYmplY3RzW29iai5pZF0ucmVnWSxcbiAgICAgICAgICAgICAgICAgICAgc2NhbGVYIDogdGhpcy5vYmplY3RzW29iai5pZF0uc2NhbGVYLFxuICAgICAgICAgICAgICAgICAgICBzY2FsZVkgOiB0aGlzLm9iamVjdHNbb2JqLmlkXS5zY2FsZVksXG4gICAgICAgICAgICAgICAgICAgIHJvdGF0aW9uIDogdGhpcy5vYmplY3RzW29iai5pZF0ucm90YXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGFscGhhIDogdGhpcy5vYmplY3RzW29iai5pZF0uYWxwaGEsXG4gICAgICAgICAgICAgICAgICAgIHZpc2libGUgOiB0aGlzLm9iamVjdHNbb2JqLmlkXS52aXNpYmxlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChwYXJlbnRfaWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9iamVjdHNbcGFyZW50X2lkXS5hZGRDaGlsZCh0aGlzLm9iamVjdHNbb2JqLmlkXSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX3N0YWdlLmFkZENoaWxkKHRoaXMub2JqZWN0c1tvYmouaWRdKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8g6Ieq5a6a5LmJ5bGe5oCnXG4gICAgICAgICAgICBpZiAoY3VzdG9tKSB7XG4gICAgICAgICAgICAgICAgY3VzdG9tKHRoaXMub2JqZWN0c1tvYmouaWRdLCBvYmopO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAob2JqLmNoaWxkcmVuKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVuZGVyKG9iai5jaGlsZHJlbiwgb2JqLmlkLCBjdXN0b20pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGhpcy5pc0xvZykge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZ3JvdXBFbmQoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLl9zdGFnZS51cGRhdGUoKTtcblxuICAgIH1cblxuICAgIF9jcmVhdGVBbmltYXRlKGRpc3BsYXlPYmplY3QsIHtcbiAgICAgICAgeCA9IG51bGwsXG4gICAgICAgIHkgPSBudWxsLFxuICAgICAgICBzY2FsZVggPSBudWxsLFxuICAgICAgICBzY2FsZVkgPSBudWxsLFxuICAgICAgICBza2V3WCA9IG51bGwsXG4gICAgICAgIHNrZXdZID0gbnVsbCxcbiAgICAgICAgcm90YXRpb24gPSBudWxsLFxuICAgICAgICBhbHBoYSA9IDEsXG4gICAgICAgIHRvcCA9IDAsXG4gICAgICAgIGR1cmF0aW9uID0gMCxcbiAgICAgICAgc3ByaXRlID0gW10sXG4gICAgICAgIHN0YXJ0QnlJZCA9IG51bGwsXG4gICAgICAgIGVuZEJ5SWQgPSBudWxsLFxuICAgICAgICBhZnRlckJ5SWQgPSBudWxsLFxuICAgICAgICBtdXNpY0J5SWQgPSBudWxsLFxuICAgIH0gPSB7fSkge1xuICAgICAgICBsZXQgbWFwUG9zID0gKHRoaXMuaXNWZXJ0aWNhbD8gZGlzcGxheU9iamVjdC55IDogZGlzcGxheU9iamVjdC54KSArIF9pbml0QW5pbWF0ZVBvc2l0aW9uKHRoaXMpLCAgICAgICAgLy8g5a+56LGh5L2N572uXG4gICAgICAgICAgICBzdGFydFggPSBkaXNwbGF5T2JqZWN0LngsICAgICAgICAgICAgICAgICAgICAvLyDliqjnlLsgWCDlvIDlp4tcbiAgICAgICAgICAgIHN0YXJ0WSA9IGRpc3BsYXlPYmplY3QueSwgICAgICAgICAgICAgICAgICAgIC8vIOWKqOeUuyBZIOW8gOWni1xuICAgICAgICAgICAgZW5kWCA9IHgsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5Yqo55S7IFgg57uT5p2fXG4gICAgICAgICAgICBlbmRZID0geSwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDliqjnlLsgWSDnu5PmnZ9cbiAgICAgICAgICAgIGluaXRBbHBoYSA9IGRpc3BsYXlPYmplY3QuYWxwaGEsXG4gICAgICAgICAgICBpbml0U2NhbGVYID0gZGlzcGxheU9iamVjdC5zY2FsZVgsXG4gICAgICAgICAgICBpbml0U2NhbGVZID0gZGlzcGxheU9iamVjdC5zY2FsZVksXG4gICAgICAgICAgICBpbml0U2tld1ggPSBkaXNwbGF5T2JqZWN0LnNrZXdYLFxuICAgICAgICAgICAgaW5pdFNrZXdZID0gZGlzcGxheU9iamVjdC5za2V3WSxcbiAgICAgICAgICAgIGluaXRSb3RhdGlvbiA9IGRpc3BsYXlPYmplY3Qucm90YXRpb24sXG4gICAgICAgICAgICBpc011c2ljID0gZmFsc2UsXG4gICAgICAgICAgICBpc1BsYXkgPSBmYWxzZTtcblxuICAgICAgICBsZXQgYW5pbWF0ZVBsYXlTdGFydCA9IDA7ICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDlr7nosaHlvIDlp4vmiafooYzliqjnlLvkvY3nva5cbiAgICAgICAgbGV0IGFuaW1hdGVQbGF5RW5kID0gMDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5a+56LGh57uT5p2f5omn6KGM5Yqo55S75L2N572uXG5cbiAgICAgICAgaWYgKHN0YXJ0QnlJZCkge1xuICAgICAgICAgICAgYW5pbWF0ZVBsYXlTdGFydCA9IHRoaXMub2JqZWN0c1tzdGFydEJ5SWRdLmFuaW1hdGlvbi5hbmltYXRlUGxheVN0YXJ0O1xuICAgICAgICB9IGVsc2UgaWYgKGFmdGVyQnlJZCkge1xuICAgICAgICAgICAgYW5pbWF0ZVBsYXlTdGFydCA9IHRoaXMub2JqZWN0c1thZnRlckJ5SWRdLmFuaW1hdGlvbi5hbmltYXRlUGxheUVuZDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChtYXBQb3MgLSB0b3AgPj0gdGhpcy5tYXBQbGF5KSB7XG4gICAgICAgICAgICAgICAgYW5pbWF0ZVBsYXlTdGFydCA9IG1hcFBvcyAtIHRvcCAtIHRoaXMubWFwUGxheTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYW5pbWF0ZVBsYXlTdGFydCA9IHRoaXMubWFwU3RhcnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZW5kQnlJZCAmJiBhbmltYXRlUGxheVN0YXJ0IDwgdGhpcy5vYmplY3RzW2VuZEJ5SWRdLmFuaW1hdGlvbi5hbmltYXRlUGxheUVuZCkge1xuICAgICAgICAgICAgYW5pbWF0ZVBsYXlFbmQgPSB0aGlzLm9iamVjdHNbZW5kQnlJZF0uYW5pbWF0aW9uLmFuaW1hdGVQbGF5RW5kO1xuICAgICAgICAgICAgZHVyYXRpb24gPSBhbmltYXRlUGxheUVuZCAtIGFuaW1hdGVQbGF5U3RhcnQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhbmltYXRlUGxheUVuZCA9IGFuaW1hdGVQbGF5U3RhcnQgKyBkdXJhdGlvbjtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIF9pbml0QW5pbWF0ZVBvc2l0aW9uKGN0eCkge1xuICAgICAgICAgICAgbGV0IHN1bSA9IDA7XG5cbiAgICAgICAgICAgIF9jb3VudFN1bVkoZGlzcGxheU9iamVjdCk7XG5cbiAgICAgICAgICAgIHJldHVybiBzdW07XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIF9jb3VudFN1bVkoZGlzcGxheU9iamVjdCkge1xuICAgICAgICAgICAgICAgIGxldCBwYXJlbnQgPSBkaXNwbGF5T2JqZWN0LnBhcmVudDtcblxuICAgICAgICAgICAgICAgIGlmIChwYXJlbnQgJiYgcGFyZW50LnBhcmVudCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBzdW0gKz0gY3R4LmlzVmVydGljYWw/IHBhcmVudC55IDogcGFyZW50Lng7XG4gICAgICAgICAgICAgICAgICAgIF9jb3VudFN1bVkocGFyZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBfYW5pbWF0ZShyYXRlKSB7XG5cbiAgICAgICAgICAgIGxldCBwcm9ncmVzcyA9IHJhdGUvZHVyYXRpb247XG5cbiAgICAgICAgICAgIGlmIChzcHJpdGUubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgIGxldCBsZW5ndGggPSBzcHJpdGUubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGxldCBkdXJhdGlvblNlZ21lbnQgPSBkdXJhdGlvbi9sZW5ndGg7XG4gICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRJbmRleCA9IE1hdGgubWluKHJhdGUvZHVyYXRpb25TZWdtZW50IHwgMCwgbGVuZ3RoIC0gMSk7XG4gICAgICAgICAgICAgICAgZGlzcGxheU9iamVjdC5pbWFnZSA9IHNwcml0ZVtjdXJyZW50SW5kZXhdO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZihlbmRYIHx8IGVuZFggPT09IDApIGRpc3BsYXlPYmplY3QueCA9IHByb2dyZXNzICogKGVuZFggLSBzdGFydFgpICsgc3RhcnRYO1xuICAgICAgICAgICAgaWYoZW5kWSB8fCBlbmRZID09PSAwKSBkaXNwbGF5T2JqZWN0LnkgPSBwcm9ncmVzcyAqICAoZW5kWSAtIHN0YXJ0WSkgKyBzdGFydFk7XG4gICAgICAgICAgICBpZihhbHBoYSB8fCBhbHBoYSA9PT0gMCkgZGlzcGxheU9iamVjdC5hbHBoYSA9IHByb2dyZXNzICogKGFscGhhIC0gaW5pdEFscGhhKSArIGluaXRBbHBoYTtcbiAgICAgICAgICAgIGlmKHNjYWxlWCB8fCBzY2FsZVggPT09IDApIGRpc3BsYXlPYmplY3Quc2NhbGVYID0gcHJvZ3Jlc3MgKiAoc2NhbGVYIC0gaW5pdFNjYWxlWCkgKyBpbml0U2NhbGVYO1xuICAgICAgICAgICAgaWYoc2NhbGVZIHx8IHNjYWxlWSA9PT0gMCkgZGlzcGxheU9iamVjdC5zY2FsZVkgPSBwcm9ncmVzcyAqIChzY2FsZVkgLSBpbml0U2NhbGVZKSArIGluaXRTY2FsZVk7XG4gICAgICAgICAgICBpZihza2V3WCB8fCBza2V3WCA9PT0gMCkgZGlzcGxheU9iamVjdC5za2V3WCA9IHByb2dyZXNzICogKHNrZXdYIC0gaW5pdFNrZXdYKSArIGluaXRTa2V3WDtcbiAgICAgICAgICAgIGlmKHNrZXdZIHx8IHNrZXdZID09PSAwKSBkaXNwbGF5T2JqZWN0LnNrZXdZID0gcHJvZ3Jlc3MgKiAoc2tld1kgLSBpbml0U2tld1kpICsgaW5pdFNrZXdZO1xuICAgICAgICAgICAgaWYocm90YXRpb24gfHwgcm90YXRpb24gPT09IDApIGRpc3BsYXlPYmplY3Qucm90YXRpb24gPSBwcm9ncmVzcyAqIChyb3RhdGlvbiAtIGluaXRSb3RhdGlvbikgKyBpbml0Um90YXRpb247XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYW5pbWF0ZVBsYXlTdGFydCxcbiAgICAgICAgICAgIGFuaW1hdGVQbGF5RW5kLFxuICAgICAgICAgICAgdXBkYXRlKHJhdGUpIHtcbiAgICAgICAgICAgICAgICBsZXQgcHJvZ3Jlc3MgPSByYXRlL2R1cmF0aW9uO1xuXG4gICAgICAgICAgICAgICAgaWYgKChwcm9ncmVzcyA9PT0gMCB8fCBwcm9ncmVzcyA9PT0gMSkgJiYgaXNQbGF5ID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHByb2dyZXNzID49IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3MgPSAxO1xuICAgICAgICAgICAgICAgICAgICBpc1BsYXkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHByb2dyZXNzIDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3MgPSAwO1xuICAgICAgICAgICAgICAgICAgICBpc1BsYXkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpc1BsYXkgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChtdXNpY0J5SWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IG11c2ljID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobXVzaWNCeUlkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG11c2ljKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNNdXNpYyA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc011c2ljID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdXNpYy5jdXJyZW50VGltZSA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbXVzaWMucGxheSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc011c2ljID09PSB0cnVlICYmIHByb2dyZXNzID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbXVzaWMucGF1c2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc011c2ljID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtdXNpYy5sb29wICYmIGlzTXVzaWMgPT09IHRydWUgJiYgcHJvZ3Jlc3MgPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtdXNpYy5wYXVzZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzTXVzaWMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIF9hbmltYXRlKHJhdGUpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0KHJhdGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXNQbGF5KSBpc1BsYXkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZiAoaXNNdXNpYykgaXNNdXNpYyA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgX2FuaW1hdGUocmF0ZSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIF9zdGF0cyAoKSB7XG4gICAgICAgIHRoaXMuc3RhdHMgPSBuZXcgU3RhdHMoKTtcbiAgICAgICAgdGhpcy5zdGF0cy5zaG93UGFuZWwoMCk7IC8vIDA6IGZwcywgMTogbXMsIDI6IG1iLCAzKzogY3VzdG9tXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5zdGF0cy5kb20pO1xuICAgIH1cbn1cblxuIl19
